import{Color,DataUtils,Matrix3,Vector2,Vector3}from"three";async function import_decompress(){try{const{WebGLRenderer:e}=await import("three"),{decompress:a}=await import("https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/utils/TextureUtils.min.js");return{decompress:a,renderer:new e({antialias:!0})}}catch(e){}try{const{CanvasTexture:e,NodeMaterial:a,QuadMesh:s,WebGPURenderer:t}=await import("three"),{texture:r,uv:n}=await import("three/tsl"),p=new t({antialias:!0});await p.init();const i=new s;return{decompress:function(s,t=1/0,p=null){const o=s.clone();o.offset.set(0,0),o.repeat.set(1,1);const c=new a;c.fragmentNode=r(o,n().flipY());const m=Math.min(o.image.width,t),l=Math.min(o.image.height,t);p.setSize(m,l),p.outputColorSpace=o.colorSpace,i.material=c,i.render(p);const u=document.createElement("canvas"),M=u.getContext("2d");u.width=m,u.height=l,M.drawImage(p.domElement,0,0,m,l);const d=new e(u);return d.offset.set(s.offset.x,s.offset.y),d.repeat.set(s.repeat.x,s.repeat.y),d.colorSpace=s.colorSpace,d.minFilter=s.minFilter,d.magFilter=s.magFilter,d.wrapS=s.wrapS,d.wrapT=s.wrapT,d.name=s.name,o.dispose(),d},renderer:p}}catch(e){throw new Error("THREE.OBJExporter: Could not import decompress function!")}}class OBJExporter{constructor(){this.decompress=null,this.renderer=null}parseAsync(e,a){const s=this;return new Promise((function(t,r){s.parse(e,t,r,a)}))}async parse(e,a,s,t={}){const r=this,{decompress:n,renderer:p}=await import_decompress();r.decompress=n,r.renderer=p;const i={filename:"model",map_flip_required:!1,maxTextureSize:1/0},o=(t=Object.assign(i,t)).map_flip_required,c=t.maxTextureSize,m=t.filename;let l="",u=0,M=0,d=0,g=0,h=0,f=0,x={},y=[],w=!1;const T=new Vector3,C=new Color,_=new Vector3,I=new Vector2,P=new Vector2,b=[];if(e.traverse((function(e){!0===e.isMesh&&function(e){let a=0,t=0,r=0,n={};const p=e.geometry,i=new Matrix3;if(!p.isBufferGeometry){if("function"==typeof s)return s("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry."),[];throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.")}w=void 0!==p.attributes.tangent;const o=p.groups,c=p.getAttribute("color"),m=p.getAttribute("position"),h=p.getAttribute("normal"),f=p.getAttribute("uv"),C=p.getAttribute("uv1"),v=p.getIndex();if(""===e.name?e.name="mesh_"+g:(e.name=e.name.replaceAll("#",""),e.name=e.name.replaceAll(" ","_")),l+="o "+e.name+"\n",e.material&&void 0!==e.material.name){""===e.material.name?e.material.name="mesh_material_"+g:(e.material.name.toUpperCase().endsWith(".PNG")||e.material.name.toUpperCase().endsWith(".JPG"))&&(e.material.name=e.material.name.substring(0,e.material.name.lastIndexOf("."))),e.material.name=e.material.name.replaceAll("#",""),e.material.name=e.material.name.replaceAll(" ","_");let a=e.material.name;!1===y.includes(a)&&(y.push(a),x[a]=e.material),x[a]?x[a]!==e.material?(a=e.material.name+"_"+g,e.material.name=a,l+="usemtl "+a+"\n",x[a]=e.material,y.push(a)):l+="usemtl "+a+"\n":(x[a]=e.material,l+="usemtl "+a+"\n")}else if(e.material&&Array.isArray(e.material))if(x["multi_"+e.name]=e.material,void 0!==o){let a=0;for(let s=0,t=o.length;s<t;s++)""===e.material[o[s].materialIndex].name?(e.material[o[s].materialIndex].name="mesh_group_material_"+g+"_"+a,a+=1):(e.material[o[s].materialIndex].name.toUpperCase().endsWith(".PNG")||e.material[o[s].materialIndex].name.toUpperCase().endsWith(".JPG"))&&(e.material[o[s].materialIndex].name=e.material[o[s].materialIndex].name.substring(0,e.material[o[s].materialIndex].name.lastIndexOf("."))),e.material[o[s].materialIndex].name=e.material[o[s].materialIndex].name.replaceAll("#",""),e.material[o[s].materialIndex].name=e.material[o[s].materialIndex].name.replaceAll(" ","_"),n[o[s].start]=e.material[o[s].materialIndex].name}else l+="usemtl multi_"+e.name+"\n";else e.material&&void 0===c&&(l+="usemtl material"+e.material.id+"\n",x["material"+e.material.id]=e.material);if(void 0!==m)for(let s=0,t=m.count;s<t;s++,a++)T.x=m.getX(s),T.y=m.getY(s),T.z=m.getZ(s),T.applyMatrix4(e.matrixWorld),c?(l+="v "+T.x+" "+T.y+" "+T.z+" "+c.getX(s)+" "+c.getY(s)+" "+c.getZ(s),l+="\n"):(l+="v "+T.x+" "+T.y+" "+T.z,l+="\n");if(void 0!==f)for(let e=0;e<f.count;e++)I.x=f.getX(e)||0,I.y=f.getY(e)||0,l+="vt "+I.x+" "+I.y,l+="\n",r++;if(void 0!==C)for(let e=0;e<C.count;e++)P.x=C.getX(e)||0,P.y=C.getY(e)||0,l+="vt1 "+P.x+" "+P.y,l+="\n";if(void 0!==h){i.getNormalMatrix(e.matrixWorld);for(let a=0;a<h.count;a++)_.x=h.getX(a)*(e.scale.x||1),_.y=h.getY(a)*(e.scale.y||1),_.z=h.getZ(a)*(e.scale.z||1),_.applyMatrix3(i).normalize(),l+="vn "+_.x+" "+_.y+" "+_.z,l+="\n",t++}if(null!==v)for(let e=0;e<v.count;e+=3){Object.keys(n).forEach((a=>{parseInt(a)===e&&(l+="usemtl "+n[e],l+="\n")}));for(let a=0;a<3;a++){const s=v.getX(e+a)+1;b[a]=u+s+(h||f?"/"+(f?M+s:"")+(h?"/"+(d+s):""):"")}l+="f "+b.join(" "),l+="\n"}else for(let e=0;e<m.count;e+=3){Object.keys(n).forEach((a=>{parseInt(a)===e&&(l+="usemtl "+n[e],l+="\n")}));for(let a=0;a<3;a++){const s=e+a+1;b[a]=u+s+(h||f?"/"+(f?M+s:"")+(h?"/"+(d+s):""):"")}l+="f "+b.join(" "),l+="\n"}u+=a,M+=r,d+=t,g+=1}(e.clone()),!0!==e.isLine&&!0!==e.isLineSegments||e.isConditionalLine||function(e){""===e.name?e.name="line_"+h:(e.name=e.name.replaceAll("#",""),e.name=e.name.replaceAll(" ","_"));let a=0;const t=e.geometry,r=e.type;if(!t.isBufferGeometry){if("function"==typeof s)return s("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry."),[];throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.")}const n=t.getAttribute("position"),p=t.getAttribute("color");if(l+="o "+e.name+"\n",e.material&&(e.material.name?""===e.material.name?e.material.name="line_material_"+h:(e.material.name=e.material.name.replaceAll("#",""),e.material.name=e.material.name.replaceAll(" ","_")):e.material.name="line_material_"+h,l+="usemtl "+e.material.name+"\n",x[e.material.name]=e.material,h+=1),void 0!==n)for(let s=0,t=n.count;s<t;s++,a++)T.x=n.getX(s),T.y=n.getY(s),T.z=n.getZ(s),T.applyMatrix4(e.matrixWorld),l+="v "+T.x+" "+T.y+" "+T.z,void 0!==p&&(C.fromBufferAttribute(p,s).convertLinearToSRGB(),l+=" "+C.r+" "+C.g+" "+C.b),l+="\n";if("LineSegments"===r)for(let e=1;e<n.count;e+=2)l+="l "+(u+e)+" "+(u+(e+1)),l+="\n";if("Line"===r){l+="l ";for(let e=1;e<n.count;e++)l+=u+e+" ";l+="\n"}u+=a}(e.clone()),!0===e.isPoints&&function(e){""===e.name?e.name="points_"+f:(e.name=e.name.replaceAll("#",""),e.name=e.name.replaceAll(" ","_"));let a=0;const t=e.geometry;if(!t.isBufferGeometry){if("function"==typeof s)return s("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry."),[];throw new Error("THREE.OBJExporter: Geometry is not of type THREE.BufferGeometry.")}const r=t.getAttribute("position"),n=t.getAttribute("color");if(l+="o "+e.name+"\n",void 0!==r){for(let s=0;s<r.count;s++)T.fromBufferAttribute(r,s),T.applyMatrix4(e.matrixWorld),l+="v "+T.x+" "+T.y+" "+T.z,void 0!==n&&(C.fromBufferAttribute(n,s).convertLinearToSRGB(),l+=" "+C.r+" "+C.g+" "+C.b),l+="\n",a++;l+="p ";for(let e=1,a=r.count;e<=a;e++)l+=u+e+" ";l+="\n"}u+=a,e.material&&(e.material.name?""===e.material.name?e.material.name="points_material_"+f:(e.material.name=e.material.name.replaceAll("#",""),e.material.name=e.material.name.replaceAll(" ","_")):e.material.name="points_material_"+f,x[e.material.name]=e.material,l+="usemtl "+e.material.name,l+="\n",f+=1)}(e.clone())})),0!==Object.keys(x).length){l="mtllib "+m+".mtl\n"+l;let e,s="# MTL file - created by a modified three.js OBJExporter\n",t=[],n={},p=[],i=[],o=1;const u="png",M=[".AVIF",".BMP",".DDS",".GIF",".KTX2",".PNG",".JPG",".JPEG",".JFIF",".PJP",".PJPEG",".SVG",".TGA",".WEBP"];for(const a of Object.keys(x))Array.isArray(x[a])?x[a].forEach((a=>{e=!1,d(a)})):(e=!1,d(x[a]));async function d(a){let m=a.name&&""!==a.name?M.some((e=>a.name.toUpperCase().endsWith(e)))?a.name.substring(0,a.name.lastIndexOf(".")):a.name:"material"+a.id;if(m=m.replaceAll("#",""),m=m.replaceAll(" ","_"),!1===i.includes(m)){i.push(m);let l=a.opacity<1?1-a.opacity:"0.0000";if(!0===a.transparent&&0===parseFloat(l)&&(l="0.0001"),s+="\nnewmtl "+m+"\n",s+="Tr "+l+"\n",s+="Tf 1.0000 1.0000 1.0000\n",s+="illum 1\n",a.aoMapIntensity&&a.aoMapIntensity>0&&(s+="Ka "+a.aoMapIntensity+" "+a.aoMapIntensity+" "+a.aoMapIntensity+"\n"),a.color&&(s+="Kd "+a.color.r+" "+a.color.g+" "+a.color.b+"\n"),a.emissive&&(s+="Ke "+a.emissive.r+" "+a.emissive.g+" "+a.emissive.b+"\n"),a.specular&&(s+="Ks "+a.specular.r+" "+a.specular.g+" "+a.specular.b+"\n"),(void 0!==a.shininess&&a.shininess>0||void 0!==a.glossiness&&a.glossiness>0)&&(s+="Ns "+(a.shininess?a.shininess:a.glossiness)+"\n"),void 0!==a.metalness&&a.metalness>=0&&(s+="Pm "+a.metalness+"\n"),void 0!==a.roughness&&a.roughness>=0&&(s+="Pr "+a.roughness+"\n"),void 0!==a.ior&&a.ior>=1&&1.5!==a.ior?s+="Ni "+a.ior+"\n":void 0!==a.refractionRatio&&a.refractionRatio<=1&&.98!==a.refractionRatio&&(s+="Ni "+a.refractionRatio+"\n"),(!a.normalScale||1===a.normalScale.x&&1===a.normalScale.y||a.sheen)&&!0!==w||(s+="Pns "+a.normalScale.x+" "+(!0===w?a.normalScale.y*=-1:a.normalScale.y)+"\n"),a.displacementMap&&(a.displacementBias&&a.displacementBias>0&&(s+="disp_b "+a.displacementBias+"\n"),a.displacementScale&&a.displacementScale<1&&(s+="disp_s "+a.displacementScale+"\n")),a.clearcoat&&a.clearcoat>0&&(s+="Pcc "+a.clearcoat+"\n",a.clearcoatRoughness&&(s+="Pcr "+a.clearcoatRoughness+"\n"),(a.clearcoatNormalScale&&(1!==a.clearcoatNormalScale.x||1!==a.clearcoatNormalScale.y)||!0===w)&&(s+="Pcn "+a.clearcoatNormalScale.x+" "+(!0===w?a.clearcoatNormalScale.y*=-1:a.clearcoatNormalScale.y)+"\n")),void 0!==a.lightMapIntensity&&1!==a.lightMapIntensity&&(s+="Pli "+a.lightMapIntensity+"\n"),void 0!==a.emissiveIntensity&&1!==a.emissiveIntensity&&(s+="Pe "+a.emissiveIntensity+"\n"),a.anisotropy&&a.anisotropy>0&&(s+="Pa "+a.anisotropy+"\n",void 0!==a.anisotropyRotation&&(s+="Par "+a.anisotropyRotation+"\n")),a.iridescence&&a.iridescence>0&&(s+="Pi "+a.iridescence+"\n",a.iridescenceIOR&&a.iridescenceIOR>=1&&(s+="Pii "+a.iridescenceIOR+"\n"),a.iridescenceThicknessRange&&(s+="Pitx "+a.iridescenceThicknessRange[0]+"\n",s+="Pity "+a.iridescenceThicknessRange[1]+"\n")),a.sheen&&a.sheen>0&&(s+="Pbr_ps "+a.sheen+"\n",a.sheenColor&&(s+="Ps "+a.sheenColor.r+" "+a.sheenColor.g+" "+a.sheenColor.b+"\n"),void 0!==a.sheenRoughness&&(s+="Psr "+a.sheenRoughness+"\n")),(a.specularColor||a.specularIntensity||a.specularColorMap||a.specularIntensityMap)&&(a.specularColor&&(s+="Psp "+a.specularColor.r+" "+a.specularColor.g+" "+a.specularColor.b+"\n"),void 0!==a.specularIntensity&&(s+="Psi "+a.specularIntensity+"\n")),a.thickness&&a.thickness>0&&(a.transmission&&a.transmission>0?a.thickness<1?s+="Pth "+140*a.thickness+"\n":s+="Pth "+11*a.thickness+"\n":a.thickness<1?s+="Pth "+210*a.thickness+"\n":s+="Pth "+17*a.thickness+"\n"),a.attenuationDistance&&a.attenuationDistance!==1/0&&(s+="Pac "+a.attenuationColor.r+" "+a.attenuationColor.g+" "+a.attenuationColor.b+"\n",s+="Pad "+(a.attenuationDistance+(a.thickness||0))+"\n"),a.transmission&&a.transmission>0&&(s+="Ptr "+a.transmission+"\n"),void 0!==a.reflectivity&&a.reflectivity>0&&(s+="Prf "+a.reflectivity+"\n"),a.alphaTest>0&&(s+="a "+a.alphaTest+"\n"),void 0!==a.depthTest&&(s+="Pdt "+(!0===a.depthTest?1:0)+"\n"),s+="s "+a.side+"\n",a.map&&a.map.image){let e=a.map;if(!0===e.isCompressedTexture&&(e=r.decompress(a.map.clone(),c,r.renderer)),!0===a.map.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=1016===a.map.type,i=a.map.repeat.x,o=a.map.repeat.y,c=a.map.offset.x,l=a.map.offset.y,M=a.map.wrapS,d=a.map.wrapT,g=a.map.center?a.map.center.x:0,h=a.map.center?a.map.center.y:0,f=a.map.rotation?a.map.rotation:0;!1===t.includes(a.map.uuid)?(t.push(a.map.uuid),n[a.map.uuid]=m,s+=!0===r?"map_Kd -r "+f+" -hd 1 -c "+g+" "+h+" -s "+i+" "+o+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n":"map_Kd -r "+f+" -c "+g+" "+h+" -s "+i+" "+o+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+=!0===r?"map_Kd -r "+f+" -hd 1 -c "+g+" "+h+" -s "+i+" "+o+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.map.uuid]+".png\n":"map_Kd -r "+f+" -c "+g+" "+h+" -s "+i+" "+o+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.map.uuid]+".png\n"}}if(a.specularMap&&a.specularMap.image){let e=a.specularMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.specularMap.clone(),c,r.renderer)),!0===a.specularMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.specularMap.repeat.x,i=a.specularMap.repeat.y,c=a.specularMap.offset.x,l=a.specularMap.offset.y,M=a.specularMap.wrapS,d=a.specularMap.wrapT,g=a.specularMap.center?a.specularMap.center.x:0,h=a.specularMap.center?a.specularMap.center.y:0,f=a.specularMap.rotation?a.specularMap.rotation:0;!1===t.includes(a.specularMap.uuid)?(m="specMap"+o,t.push(a.specularMap.uuid),n[a.specularMap.uuid]=m,s+="map_Ks -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Ks -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.specularMap.uuid]+".png\n"}}if(a.emissiveMap&&a.emissiveMap.image){let e=a.emissiveMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.emissiveMap.clone(),c,r.renderer)),!0===a.emissiveMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.emissiveMap.repeat.x,i=a.emissiveMap.repeat.y,c=a.emissiveMap.offset.x,l=a.emissiveMap.offset.y,M=a.emissiveMap.wrapS,d=a.emissiveMap.wrapT,g=a.emissiveMap.center?a.emissiveMap.center.x:0,h=a.emissiveMap.center?a.emissiveMap.center.y:0,f=a.emissiveMap.rotation?a.emissiveMap.rotation:0;!1===t.includes(a.emissiveMap.uuid)?(m="emMap"+o,t.push(a.emissiveMap.uuid),n[a.emissiveMap.uuid]=m,s+="map_Ke -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Ke -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.emissiveMap.uuid]+".png\n"}}if(a.bumpMap&&a.bumpMap.image){let e=a.bumpMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.bumpMap.clone(),c,r.renderer)),!0===a.bumpMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.bumpMap.repeat.x,i=a.bumpMap.repeat.y,c=a.bumpMap.offset.x,l=a.bumpMap.offset.y,M=a.bumpMap.wrapS,d=a.bumpMap.wrapT,g=a.bumpMap.center?a.bumpMap.center.x:0,h=a.bumpMap.center?a.bumpMap.center.y:0,f=a.bumpMap.rotation?a.bumpMap.rotation:0;!1===t.includes(a.bumpMap.uuid)?(m="bmMap"+o,t.push(a.bumpMap.uuid),n[a.bumpMap.uuid]=m,1===a.bumpScale?s+="map_bump -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n":s+="map_bump -bm "+a.bumpScale+" -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):1===a.bumpScale?s+="map_bump -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.bumpMap.uuid]+".png\n":s+="map_bump -bm "+a.bumpScale+" -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.bumpMap.uuid]+".png\n"}}if(a.lightMap&&a.lightMap.image){let e=a.lightMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.lightMap.clone(),c,r.renderer)),!0===a.lightMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.lightMap.repeat.x,i=a.lightMap.repeat.y,c=a.lightMap.offset.x,l=a.lightMap.offset.y,M=a.lightMap.wrapS,d=a.lightMap.wrapT,g=a.lightMap.center?a.lightMap.center.x:0,h=a.lightMap.center?a.lightMap.center.y:0,f=a.lightMap.rotation?a.lightMap.rotation:0;!1===t.includes(a.lightMap.uuid)?(m="ltMap"+o,t.push(a.lightMap.uuid),n[a.lightMap.uuid]=m,s+="Pbr_pl_map -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="Pbr_pl_map -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.lightMap.uuid]+".png\n"}}if(a.metalnessMap&&a.metalnessMap.image&&!1===e){let i=a.metalnessMap;if(!0===i.isCompressedTexture&&(i=r.decompress(a.metalnessMap.clone(),c,r.renderer)),!0===a.metalnessMap.isCompressedTexture||i.image.src||i.image.data||i.image instanceof ImageBitmap){const r=a.metalnessMap.repeat.x,c=a.metalnessMap.repeat.y,l=a.metalnessMap.offset.x,M=a.metalnessMap.offset.y,d=a.metalnessMap.wrapS,g=a.metalnessMap.wrapT,h=a.metalnessMap.center?a.metalnessMap.center.x:0,f=a.metalnessMap.center?a.metalnessMap.center.y:0,x=a.metalnessMap.rotation?a.metalnessMap.rotation:0;!1===t.includes(a.metalnessMap.uuid)?(m="metalMap"+o,t.push(a.metalnessMap.uuid),n[a.metalnessMap.uuid]=m,a.roughnessMap&&a.roughnessMap===a.metalnessMap?(s+="map_Px -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+m+".png\n",e=!0):s+="map_Pm -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+m+".png\n",p.push({name:m,ext:u,data:v(i.image,u)})):a.roughnessMap&&a.roughnessMap===a.metalnessMap?(s+="map_Px -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+n[a.metalnessMap.uuid]+".png\n",e=!0):s+="map_Pm -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+n[a.metalnessMap.uuid]+".png\n"}}if(a.roughnessMap&&a.roughnessMap.image&&!1===e){let i=a.roughnessMap;if(!0===i.isCompressedTexture&&(i=r.decompress(a.roughnessMap.clone(),c,r.renderer)),!0===a.roughnessMap.isCompressedTexture||i.image.src||i.image.data||i.image instanceof ImageBitmap){const r=a.roughnessMap.repeat.x,c=a.roughnessMap.repeat.y,l=a.roughnessMap.offset.x,M=a.roughnessMap.offset.y,d=a.roughnessMap.wrapS,g=a.roughnessMap.wrapT,h=a.roughnessMap.center?a.roughnessMap.center.x:0,f=a.roughnessMap.center?a.roughnessMap.center.y:0,x=a.roughnessMap.rotation?a.roughnessMap.rotation:0;!1===t.includes(a.roughnessMap.uuid)?(m="roughMap"+o,t.push(a.roughnessMap.uuid),n[a.roughnessMap.uuid]=m,a.metalnessMap&&a.metalnessMap===a.roughnessMap?(s+="map_Px -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+m+".png\n",e=!0):s+="map_Pr -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+m+".png\n",p.push({name:m,ext:u,data:v(i.image,u)})):a.metalnessMap&&a.metalnessMap===a.roughnessMap?(s+="map_Px -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+n[a.roughnessMap.uuid]+".png\n",e=!0):s+="map_Pr -r "+x+" -c "+h+" "+f+" -s "+r+" "+c+" 1 -o "+l+" "+M+" 0 -w "+d+" "+g+" "+n[a.roughnessMap.uuid]+".png\n"}}if(a.displacementMap&&a.displacementMap.image){let e=a.displacementMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.displacementMap.clone(),c,r.renderer)),!0===a.displacementMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.displacementMap.repeat.x,i=a.displacementMap.repeat.y,c=a.displacementMap.offset.x,l=a.displacementMap.offset.y,M=a.displacementMap.wrapS,d=a.displacementMap.wrapT,g=a.displacementMap.center?a.displacementMap.center.x:0,h=a.displacementMap.center?a.displacementMap.center.y:0,f=a.displacementMap.rotation?a.displacementMap.rotation:0;!1===t.includes(a.displacementMap.uuid)?(m="displaceMap"+o,t.push(a.displacementMap.uuid),n[a.displacementMap.uuid]=m,s+="disp -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="disp -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.displacementMap.uuid]+".png\n"}}if(a.normalMap&&a.normalMap.image){let e=a.normalMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.normalMap.clone(),c,r.renderer)),!0===a.normalMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.normalMap.repeat.x,i=a.normalMap.repeat.y,c=a.normalMap.offset.x,l=a.normalMap.offset.y,M=a.normalMap.wrapS,d=a.normalMap.wrapT,g=a.normalMap.center?a.normalMap.center.x:0,h=a.normalMap.center?a.normalMap.center.y:0,f=a.normalMap.rotation?a.normalMap.rotation:0;!1===t.includes(a.normalMap.uuid)?(m="norMap"+o,t.push(a.normalMap.uuid),n[a.normalMap.uuid]=m,s+="norm -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="norm -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.normalMap.uuid]+".png\n"}}if(a.alphaMap&&a.alphaMap.image){let e=a.alphaMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.alphaMap.clone(),c,r.renderer)),!0===a.alphaMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.alphaMap.repeat.x,i=a.alphaMap.repeat.y,c=a.alphaMap.offset.x,l=a.alphaMap.offset.y,M=a.alphaMap.wrapS,d=a.alphaMap.wrapT,g=a.alphaMap.center?a.alphaMap.center.x:0,h=a.alphaMap.center?a.alphaMap.center.y:0,f=a.alphaMap.rotation?a.alphaMap.rotation:0;!1===t.includes(a.alphaMap.uuid)?(m="alpMap"+o,t.push(a.alphaMap.uuid),n[a.alphaMap.uuid]=m,s+="map_d -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_d -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.alphaMap.uuid]+".png\n"}}if(a.aoMap&&a.aoMap.image){let e=a.aoMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.aoMap.clone(),c,r.renderer)),!0===a.aoMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.aoMap.repeat.x,i=a.aoMap.repeat.y,c=a.aoMap.offset.x,l=a.aoMap.offset.y,M=a.aoMap.wrapS,d=a.aoMap.wrapT,g=a.aoMap.center?a.aoMap.center.x:0,h=a.aoMap.center?a.aoMap.center.y:0,f=a.aoMap.rotation?a.aoMap.rotation:0;!1===t.includes(a.aoMap.uuid)?(m="ambMap"+o,t.push(a.aoMap.uuid),n[a.aoMap.uuid]=m,s+="map_Ka -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Ka -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.aoMap.uuid]+".png\n"}}if(a.anisotropyMap&&a.anisotropyMap.image){let e=a.anisotropyMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.anisotropyMap.clone(),c,r.renderer)),!0===a.anisotropyMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.anisotropyMap.repeat.x,i=a.anisotropyMap.repeat.y,c=a.anisotropyMap.offset.x,l=a.anisotropyMap.offset.y,M=a.anisotropyMap.wrapS,d=a.anisotropyMap.wrapT,g=a.anisotropyMap.center.x,h=a.anisotropyMap.center.y,f=a.anisotropyMap.rotation;!1===t.includes(a.anisotropyMap.uuid)?(m="anisMap"+o,t.push(a.anisotropyMap.uuid),n[a.anisotropyMap.uuid]=m,s+="map_Pa -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pa -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.anisotropyMap.uuid]+".png\n"}}if(a.clearcoatMap&&a.clearcoatMap.image){let e=a.clearcoatMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.clearcoatMap.clone(),c,r.renderer)),!0===a.clearcoatMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.clearcoatMap.repeat.x,i=a.clearcoatMap.repeat.y,c=a.clearcoatMap.offset.x,l=a.clearcoatMap.offset.y,M=a.clearcoatMap.wrapS,d=a.clearcoatMap.wrapT,g=a.clearcoatMap.center.x,h=a.clearcoatMap.center.y,f=a.clearcoatMap.rotation;!1===t.includes(a.clearcoatMap.uuid)?(m="ccMap"+o,t.push(a.clearcoatMap.uuid),n[a.clearcoatMap.uuid]=m,s+="map_Pcc -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pcc -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.clearcoatMap.uuid]+".png\n"}}if(a.clearcoatNormalMap&&a.clearcoatNormalMap.image){let e=a.clearcoatNormalMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.clearcoatNormalMap.clone(),c,r.renderer)),!0===a.clearcoatNormalMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.clearcoatNormalMap.repeat.x,i=a.clearcoatNormalMap.repeat.y,c=a.clearcoatNormalMap.offset.x,l=a.clearcoatNormalMap.offset.y,M=a.clearcoatNormalMap.wrapS,d=a.clearcoatNormalMap.wrapT,g=a.clearcoatNormalMap.center.x,h=a.clearcoatNormalMap.center.y,f=a.clearcoatNormalMap.rotation;!1===t.includes(a.clearcoatNormalMap.uuid)?(m="ccnMap"+o,t.push(a.clearcoatNormalMap.uuid),n[a.clearcoatNormalMap.uuid]=m,s+="map_Pcn -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pcn -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.clearcoatNormalMap.uuid]+".png\n"}}if(a.clearcoatRoughnessMap&&a.clearcoatRoughnessMap.image){let e=a.clearcoatRoughnessMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.clearcoatRoughnessMap.clone(),c,r.renderer)),!0===a.clearcoatRoughnessMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.clearcoatRoughnessMap.repeat.x,i=a.clearcoatRoughnessMap.repeat.y,c=a.clearcoatRoughnessMap.offset.x,l=a.clearcoatRoughnessMap.offset.y,M=a.clearcoatRoughnessMap.wrapS,d=a.clearcoatRoughnessMap.wrapT,g=a.clearcoatRoughnessMap.center.x,h=a.clearcoatRoughnessMap.center.y,f=a.clearcoatRoughnessMap.rotation;!1===t.includes(a.clearcoatRoughnessMap.uuid)?(m="ccrMap"+o,t.push(a.clearcoatRoughnessMap.uuid),n[a.clearcoatRoughnessMap.uuid]=m,s+="map_Pcr -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pcr -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.clearcoatRoughnessMap.uuid]+".png\n"}}if(a.iridescenceMap&&a.iridescenceMap.image){let e=a.iridescenceMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.iridescenceMap.clone(),c,r.renderer)),!0===a.iridescenceMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.iridescenceMap.repeat.x,i=a.iridescenceMap.repeat.y,c=a.iridescenceMap.offset.x,l=a.iridescenceMap.offset.y,M=a.iridescenceMap.wrapS,d=a.iridescenceMap.wrapT,g=a.iridescenceMap.center.x,h=a.iridescenceMap.center.y,f=a.iridescenceMap.rotation;!1===t.includes(a.iridescenceMap.uuid)?(m="irMap"+o,t.push(a.iridescenceMap.uuid),n[a.iridescenceMap.uuid]=m,s+="map_Pi -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pi -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.iridescenceMap.uuid]+".png\n"}}if(a.iridescenceThicknessMap&&a.iridescenceThicknessMap.image){let e=a.iridescenceThicknessMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.iridescenceThicknessMap.clone(),c,r.renderer)),!0===a.iridescenceThicknessMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.iridescenceThicknessMap.repeat.x,i=a.iridescenceThicknessMap.repeat.y,c=a.iridescenceThicknessMap.offset.x,l=a.iridescenceThicknessMap.offset.y,M=a.iridescenceThicknessMap.wrapS,d=a.iridescenceThicknessMap.wrapT,g=a.iridescenceThicknessMap.center.x,h=a.iridescenceThicknessMap.center.y,f=a.iridescenceThicknessMap.rotation;!1===t.includes(a.iridescenceThicknessMap.uuid)?(m="irthMap"+o,t.push(a.iridescenceThicknessMap.uuid),n[a.iridescenceThicknessMap.uuid]=m,s+="map_Pit -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pit -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.iridescenceThicknessMap.uuid]+".png\n"}}if(a.sheenColorMap&&a.sheenColorMap.image){let e=a.sheenColorMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.sheenColorMap.clone(),c,r.renderer)),!0===a.sheenColorMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.sheenColorMap.repeat.x,i=a.sheenColorMap.repeat.y,c=a.sheenColorMap.offset.x,l=a.sheenColorMap.offset.y,M=a.sheenColorMap.wrapS,d=a.sheenColorMap.wrapT,g=a.sheenColorMap.center.x,h=a.sheenColorMap.center.y,f=a.sheenColorMap.rotation;!1===t.includes(a.sheenColorMap.uuid)?(m="shcMap"+o,t.push(a.sheenColorMap.uuid),n[a.sheenColorMap.uuid]=m,s+="map_Psc -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Psc -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.sheenColorMap.uuid]+".png\n"}}if(a.sheenRoughnessMap&&a.sheenRoughnessMap.image){let e=a.sheenRoughnessMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.sheenRoughnessMap.clone(),c,r.renderer)),!0===a.sheenRoughnessMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.sheenRoughnessMap.repeat.x,i=a.sheenRoughnessMap.repeat.y,c=a.sheenRoughnessMap.offset.x,l=a.sheenRoughnessMap.offset.y,M=a.sheenRoughnessMap.wrapS,d=a.sheenRoughnessMap.wrapT,g=a.sheenRoughnessMap.center.x,h=a.sheenRoughnessMap.center.y,f=a.sheenRoughnessMap.rotation;!1===t.includes(a.sheenRoughnessMap.uuid)?(m="shrMap"+o,t.push(a.sheenRoughnessMap.uuid),n[a.sheenRoughnessMap.uuid]=m,s+="map_Psr -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Psr -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.sheenRoughnessMap.uuid]+".png\n"}}if(a.specularIntensityMap&&a.specularIntensityMap.image){let e=a.specularIntensityMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.specularIntensityMap.clone(),c,r.renderer)),!0===a.specularIntensityMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.specularIntensityMap.repeat.x,i=a.specularIntensityMap.repeat.y,c=a.specularIntensityMap.offset.x,l=a.specularIntensityMap.offset.y,M=a.specularIntensityMap.wrapS,d=a.specularIntensityMap.wrapT,g=a.specularIntensityMap.center.x,h=a.specularIntensityMap.center.y,f=a.specularIntensityMap.rotation;!1===t.includes(a.specularIntensityMap.uuid)?(m="spiMap"+o,t.push(a.specularIntensityMap.uuid),n[a.specularIntensityMap.uuid]=m,s+="map_Psi -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Psi -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.specularIntensityMap.uuid]+".png\n"}}if(a.specularColorMap&&a.specularColorMap.image){let e=a.specularColorMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.specularColorMap.clone(),c,r.renderer)),!0===a.specularColorMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.specularColorMap.repeat.x,i=a.specularColorMap.repeat.y,c=a.specularColorMap.offset.x,l=a.specularColorMap.offset.y,M=a.specularColorMap.wrapS,d=a.specularColorMap.wrapT,g=a.specularColorMap.center.x,h=a.specularColorMap.center.y,f=a.specularColorMap.rotation;!1===t.includes(a.specularColorMap.uuid)?(m="spcMap"+o,t.push(a.specularColorMap.uuid),n[a.specularColorMap.uuid]=m,s+="map_Psp -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Psp -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.specularColorMap.uuid]+".png\n"}}if(a.thicknessMap&&a.thicknessMap.image){let e=a.thicknessMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.thicknessMap.clone(),c,r.renderer)),!0===a.thicknessMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.thicknessMap.repeat.x,i=a.thicknessMap.repeat.y,c=a.thicknessMap.offset.x,l=a.thicknessMap.offset.y,M=a.thicknessMap.wrapS,d=a.thicknessMap.wrapT,g=a.thicknessMap.center.x,h=a.thicknessMap.center.y,f=a.thicknessMap.rotation;!1===t.includes(a.thicknessMap.uuid)?(m="thMap"+o,t.push(a.thicknessMap.uuid),n[a.thicknessMap.uuid]=m,s+="map_Pth -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Pth -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.thicknessMap.uuid]+".png\n"}}if(a.transmissionMap&&a.transmissionMap.image){let e=a.transmissionMap;if(!0===e.isCompressedTexture&&(e=r.decompress(a.transmissionMap.clone(),c,r.renderer)),!0===a.transmissionMap.isCompressedTexture||e.image.src||e.image.data||e.image instanceof ImageBitmap){const r=a.transmissionMap.repeat.x,i=a.transmissionMap.repeat.y,c=a.transmissionMap.offset.x,l=a.transmissionMap.offset.y,M=a.transmissionMap.wrapS,d=a.transmissionMap.wrapT,g=a.transmissionMap.center.x,h=a.transmissionMap.center.y,f=a.transmissionMap.rotation;!1===t.includes(a.transmissionMap.uuid)?(m="trMap"+o,t.push(a.transmissionMap.uuid),n[a.transmissionMap.uuid]=m,s+="map_Ptr -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+m+".png\n",p.push({name:m,ext:u,data:v(e.image,u)})):s+="map_Ptr -r "+f+" -c "+g+" "+h+" -s "+r+" "+i+" 1 -o "+c+" "+l+" 0 -w "+M+" "+d+" "+n[a.transmissionMap.uuid]+".png\n"}}o+=1}}Promise.all(p).then((()=>{if(null!==r.renderer&&(r.renderer.dispose(),r.renderer=null),"function"!=typeof a)return{obj:l,mtl:s,tex:p};a({obj:l,mtl:s,tex:p})}))}else{if(null!==r.renderer&&(r.renderer.dispose(),r.renderer=null),"function"!=typeof a)return{obj:l};a({obj:l})}function v(e,a){let s,t;if("canvas"==typeof e)s=e;else{s=s||document.createElement("canvas");let a=c/Math.max(e.width,e.height);if(s.width=e.width*Math.min(1,a),s.height=e.height*Math.min(1,a),t=t||s.getContext("2d"),!0===o&&(t.translate(0,s.height),t.scale(1,-1)),e instanceof ImageData)t.putImageData(e,0,0);else if(!e.data||e.data.constructor!==Float32Array&&e.data.constructor!==Uint16Array)if(e.data&&e.data.constructor===Uint8Array){let a=new ImageData(new Uint8ClampedArray(e.data),e.width,e.height);t.putImageData(a,0,0)}else t.drawImage(e,0,0,s.width,s.height);else{let a=e.data.constructor===Float32Array,s=new Uint8Array(e.data.length),r=DataUtils.fromHalfFloat;for(let t=0;t<e.data.length;t++){let n=Math.max(-1,Math.min(1,!0===a?e.data[t]:r(e.data[t])));n=n<0?32768*n:32767*n,s[t]=n/128}let n=new ImageData(new Uint8ClampedArray(s.buffer),e.width,e.height);t.putImageData(n,0,0)}}return function(e){const a=atob(e),s=new Uint8Array(a.length);for(let e=0,t=s.length;e<t;e++)s[e]=a.charCodeAt(e);return s}(s.toDataURL(`image/${a}`,1).split(",")[1])}}}export{OBJExporter};