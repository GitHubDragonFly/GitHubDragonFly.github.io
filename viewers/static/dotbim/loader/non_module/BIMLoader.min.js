!function(){class e extends THREE.Loader{constructor(e){super(e)}load(e,t,r,o){const n=this,s=new THREE.FileLoader(n.manager);s.setPath(n.path),s.setResponseType("text"),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,(function(r){try{t(n.parse(r))}catch(t){o&&o(t),n.manager.itemError(e)}}),r,o)}parse(e){const t={},r=new THREE.Group,o=new THREE.Vector3(1,1,1);function n(e,t=3,r=0){let o=[];for(let r=0,n=e.length;r<n;r+=4){let n=e[r+0]/255,s=e[r+1]/255,a=e[r+2]/255,c=e[r+3]/255;for(let e=0;e<t;e++)o.push(n,s,a,c)}for(;o.length<r;)for(let e=0;e<t;e++)o.push(o[0],o[1],o[2],o[3]);return o}return function(e){if("string"!=typeof e)throw new Error("THREE.BIMLoader: Unknown format!");e=JSON.parse(e);const{schema_version:s,meshes:a,elements:c,info:i}=e;if(r.userData.schema_version=s||{},r.userData.info=i||{},i.Name&&""!==i.Name&&(r.name=i.Name),!a||!c)throw new Error("THREE.BIMLoader: No meshes or elements found!");for(const e of c)if(t[e.mesh_id]||(t[e.mesh_id]={face_colors_group:{},color_group:{}}),e.face_colors){let r=t[e.mesh_id].face_colors_group[e.face_colors];r?r.instance_count++:t[e.mesh_id].face_colors_group[e.face_colors]={instance_count:1,current_instance:0,mesh:null}}else{if(!e.color)continue;let r=[e.color.r,e.color.g,e.color.b,e.color.a],o=t[e.mesh_id].color_group[r];o?o.instance_count++:t[e.mesh_id].color_group[r]={instance_count:1,current_instance:0,mesh:null}}const l=function(e){return e.map((e=>function(e){const{mesh_id:t,coordinates:r,indices:o,colors:s}=e;let a=new THREE.BufferGeometry;a.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),a.computeVertexNormals(),s?(buffer_colors=n(s,3,4*a.attributes.position.count),a.setAttribute("color",new THREE.Float32BufferAttribute(buffer_colors,4))):o&&a.setIndex(o);return a.userData.mesh_id=t,a}(e)))}(a);if(function(e,r){return e.map((e=>function(e,r){let s,{mesh_id:a,vector:c,rotation:i,guid:l,type:u,color:f,face_colors:d,info:E}=e;if(r[a])s=r[a].clone();else{for(const e of r)if(e.userData.mesh_id===a){s=e.clone();break}if(!s)throw new Error("THREE.BIMLoader: Geometry not found!")}let _=E.Name||"";s.computeVertexNormals();let m,h=new THREE.MeshStandardMaterial({name:E.Material||"Default Material",side:THREE.DoubleSide,flatShading:!1,transparent:!0,metalness:.4,roughness:.6,color:16777215});f&&0===f.r&&0===f.g&&0===f.b&&0===f.a&&(f=null);if(d){s.index&&(s=s.toNonIndexed()),s.hasAttribute("color")&&s.deleteAttribute("color");let e=n(d,3,4*s.attributes.position.count);s.setAttribute("color",new THREE.Float32BufferAttribute(e,4)),h.color.setRGB(1,1,1),h.opacity=1,h.transparent=!0,h.vertexColors=!0}else f&&(s=s.clone(),s.deleteAttribute("color"),h.color=new THREE.Color(f.r/255,f.g/255,f.b/255,THREE.SRGBColorSpace),h.opacity=f.a/255,h.transparent=h.opacity<1,h.needsUpdate=!0);c||(c={x:0,y:0,z:0});i||(i={qx:0,qy:0,qz:0,qw:1});if(d&&t[a].face_colors_group[d]){let e=t[a].face_colors_group[d];null===e.mesh&&(e.mesh=new THREE.InstancedMesh(s,h,e.instance_count)),m=e.mesh;let r=new THREE.Vector3(c.x,c.y,c.z),n=new THREE.Quaternion(i.qx,i.qy,i.qz,i.qw),f=(new THREE.Matrix4).compose(r,n,o);m.setMatrixAt(e.current_instance,f),m.instanceMatrix.needsUpdate=!0,""===_&&(_="mesh_"+a+"_"+m.id+"_"+e.current_instance),m.userData[e.current_instance]={name:_,guid:l||{},type:u||{},info:E||{}},e.current_instance++}else{if(!f)return;let e=[f.r,f.g,f.b,f.a],r=t[a].color_group[e];null===r.mesh&&(r.mesh=new THREE.InstancedMesh(s,h,r.instance_count)),m=r.mesh;let n=new THREE.Vector3(c.x,c.y,c.z),d=new THREE.Quaternion(i.qx,i.qy,i.qz,i.qw),p=(new THREE.Matrix4).compose(n,d,o);m.setMatrixAt(r.current_instance,p),m.instanceMatrix.needsUpdate=!0,m.setColorAt(r.current_instance,h.color),m.instanceColor.needsUpdate=!0,""===_&&(_="mesh_"+a+"_"+m.id+"_"+r.current_instance),m.userData[r.current_instance]={name:_,guid:l||{},type:u||{},info:E||{}},r.current_instance++}E.Name&&""!==E.Name&&(m.name=E.Name);return m}(e,r)))}(c,l).forEach((e=>{e&&r.add(e)})),0===r.children.length)throw new Error("THREE.BIMLoader: No meshes found!");return r.children.length>1&&r.rotateX(-Math.PI/2),r}(e)}}THREE.BIMLoader=e}();