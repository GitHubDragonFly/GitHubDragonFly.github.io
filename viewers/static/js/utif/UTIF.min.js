!function(){var UTIF={},pako;function log(){"undefined"!=typeof process&&"development"!=process.env.NODE_ENV||console.log.apply(console,arguments)}"object"==typeof module?module.exports=UTIF:self.UTIF=UTIF,function(UTIF,pako){var e,U,Z,u,K,V,g,N,O,h,w,m,i,D,L,T,main,rest;!function(){"use strict";var W=function a1(){function W(p){this.message="JPEG error: "+p}return W.prototype=new Error,W.prototype.name="JpegError",W.constructor=W,W}(),ak=function ag(){var p=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,ac=799,ah=3406,ao=2276,ar=1567,ai=3784,s=5793,ad=2896;function ak(Q){null==Q&&(Q={}),null==Q.w&&(Q.w=-1),this.V=Q.n,this.N=Q.w}function a5(Q,h){for(var f=0,G=[],n,E,a=16,F;a>0&&!Q[a-1];)a--;G.push({children:[],index:0});var C=G[0];for(n=0;n<a;n++){for(E=0;E<Q[n];E++){for((C=G.pop()).children[C.index]=h[f];C.index>0;)C=G.pop();for(C.index++,G.push(C);G.length<=n;)G.push(F={children:[],index:0}),C.children[C.index]=F.children,C=F;f++}n+1<a&&(G.push(F={children:[],index:0}),C.children[C.index]=F.children,C=F)}return G[0].children}function a2(Q,h,f){return 64*((Q.P+1)*h+f)}function a7(Q,h,f,G,n,E,a,C,F,d){null==d&&(d=!1);var T=f.m,U=f.Z,z=h,J=0,V=0,r=0,D=0,a8,q=0,X,O,_,N,e,K,x=0,k,g,R,c;function Y(){if(V>0)return V--,J>>V&1;if(255===(J=Q[h++])){var I=Q[h++];if(I){if(220===I&&d){var l=Z(Q,h+=2);if(h+=2,l>0&&l!==f.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",l)}else if(217===I){if(d){var M=8*q;if(M>0&&M<f.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",M)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new W("unexpected marker")}}return V=7,J>>>7}function u(I){for(var l=I;;){switch(typeof(l=l[Y()])){case"number":return l;case"object":continue}throw new W("invalid huffman sequence")}}function m(I){for(var e=0;I>0;)e=e<<1|Y(),I--;return e}function j(I){if(1===I)return 1===Y()?1:-1;var e=m(I);return e>=1<<I-1?e:e+(-1<<I)+1}function v(X,I){var l=u(X.J),M=0===l?0:j(l),N=1;for(X.D[I]=X.Q+=M;N<64;){var S=u(X.i),i=15&S,A=S>>4;if(0!==i){var o=p[N+=A];X.D[I+o]=j(i),N++}else{if(A<15)break;N+=16}}}function $(X,I){var l=u(X.J),M=0===l?0:j(l)<<F;X.D[I]=X.Q+=M}function b(X,I){X.D[I]|=Y()<<F}function P(X,I){if(r>0)r--;else for(var N=E,l=a;N<=l;){var M=u(X.i),S=15&M,i=M>>4;if(0!==S){var A=p[N+=i];X.D[I+A]=j(S)*(1<<F),N++}else{if(i<15){r=m(i)+(1<<i)-1;break}N+=16}}}function a4(X,I){for(var N=E,l=a,M=0,S,i;N<=l;){var A=I+p[N],o=X.D[A]<0?-1:1;switch(D){case 0:if(M=(i=u(X.i))>>4,0===(S=15&i))M<15?(r=m(M)+(1<<M),D=4):(M=16,D=1);else{if(1!==S)throw new W("invalid ACn encoding");a8=j(S),D=M?2:3}continue;case 1:case 2:X.D[A]?X.D[A]+=o*(Y()<<F):0===--M&&(D=2===D?3:0);break;case 3:X.D[A]?X.D[A]+=o*(Y()<<F):(X.D[A]=a8<<F,D=0);break;case 4:X.D[A]&&(X.D[A]+=o*(Y()<<F))}N++}4===D&&0===--r&&(D=0)}function H(X,I,x,l,M){var S,i=x%T;q=(x/T|0)*X.A+l;var A=i*X.h+M,o;I(X,a2(X,q,A))}function w(X,I,x){q=x/X.P|0;var l=x%X.P,M;I(X,a2(X,q,l))}var y=G.length;for(K=U?0===E?0===C?$:b:0===C?P:a4:v,g=1===y?G[0].P*G[0].c:T*f.R;x<=g;){var L=n?Math.min(g-x,n):g;if(L>0){for(O=0;O<y;O++)G[O].Q=0;if(r=0,1===y)for(X=G[0],e=0;e<L;e++)w(X,K,x),x++;else for(e=0;e<L;e++){for(O=0;O<y;O++)for(R=(X=G[O]).h,c=X.A,_=0;_<c;_++)for(N=0;N<R;N++)H(X,K,x,_,N);x++}}if(V=0,!(k=an(Q,h)))break;if(k.u){var a6=L>0?"unexpected":"excessive";h=k.offset}if(!(k.M>=65488&&k.M<=65495))break;h+=2}return h-z}function al(Q,h,f){var G=Q.$,n=Q.D,E,a,C,F,d,T,U,z,J,V,Y,u,m,j,v,$,b;if(!G)throw new W("missing required Quantization Table.");for(var r=0;r<64;r+=8)J=n[h+r],V=n[h+r+1],Y=n[h+r+2],u=n[h+r+3],m=n[h+r+4],j=n[h+r+5],v=n[h+r+6],$=n[h+r+7],J*=G[r],0!=(V|Y|u|m|j|v|$)?(V*=G[r+1],Y*=G[r+2],u*=G[r+3],m*=G[r+4],j*=G[r+5],v*=G[r+6],$*=G[r+7],a=(E=(E=s*J+128>>8)+(a=s*m+128>>8)+1>>1)-a,b=(C=Y)*ai+(F=v)*ar+128>>8,C=C*ar-F*ai+128>>8,U=(d=(d=ad*(V-$)+128>>8)+(U=j<<4)+1>>1)-U,T=(z=(z=ad*(V+$)+128>>8)+(T=u<<4)+1>>1)-T,F=(E=E+(F=b)+1>>1)-F,C=(a=a+C+1>>1)-C,b=d*ao+z*ah+2048>>12,d=d*ah-z*ao+2048>>12,z=b,b=T*ac+U*t+2048>>12,T=T*t-U*ac+2048>>12,U=b,f[r]=E+z,f[r+7]=E-z,f[r+1]=a+U,f[r+6]=a-U,f[r+2]=C+T,f[r+5]=C-T,f[r+3]=F+d,f[r+4]=F-d):(b=s*J+512>>10,f[r]=b,f[r+1]=b,f[r+2]=b,f[r+3]=b,f[r+4]=b,f[r+5]=b,f[r+6]=b,f[r+7]=b);for(var P=0;P<8;++P)J=f[P],0!=((V=f[P+8])|(Y=f[P+16])|(u=f[P+24])|(m=f[P+32])|(j=f[P+40])|(v=f[P+48])|($=f[P+56]))?(a=(E=4112+((E=s*J+2048>>12)+(a=s*m+2048>>12)+1>>1))-a,b=(C=Y)*ai+(F=v)*ar+2048>>12,C=C*ar-F*ai+2048>>12,F=b,U=(d=(d=ad*(V-$)+2048>>12)+(U=j)+1>>1)-U,T=(z=(z=ad*(V+$)+2048>>12)+(T=u)+1>>1)-T,b=d*ao+z*ah+2048>>12,d=d*ah-z*ao+2048>>12,z=b,b=T*ac+U*t+2048>>12,T=T*t-U*ac+2048>>12,(J=(E=E+F+1>>1)+z)<16?J=0:J>=4080?J=255:J>>=4,(V=(a=a+C+1>>1)+(U=b))<16?V=0:V>=4080?V=255:V>>=4,(Y=(C=a-C)+T)<16?Y=0:Y>=4080?Y=255:Y>>=4,(u=(F=E-F)+d)<16?u=0:u>=4080?u=255:u>>=4,(m=F-d)<16?m=0:m>=4080?m=255:m>>=4,(j=C-T)<16?j=0:j>=4080?j=255:j>>=4,(v=a-U)<16?v=0:v>=4080?v=255:v>>=4,($=E-z)<16?$=0:$>=4080?$=255:$>>=4,n[h+P]=J,n[h+P+8]=V,n[h+P+16]=Y,n[h+P+24]=u,n[h+P+32]=m,n[h+P+40]=j,n[h+P+48]=v,n[h+P+56]=$):(b=(b=s*J+8192>>14)<-2040?0:b>=2024?255:b+2056>>4,n[h+P]=b,n[h+P+8]=b,n[h+P+16]=b,n[h+P+24]=b,n[h+P+32]=b,n[h+P+40]=b,n[h+P+48]=b,n[h+P+56]=b)}function a0(Q,h){for(var f=h.P,G=h.c,n=new Int16Array(64),E=0;E<G;E++)for(var a=0;a<f;a++){var C;al(h,a2(h,E,a),n)}return h.D}function an(Q,h,f){null==f&&(f=h);var G=Q.length-1,n=f<h?f:h;if(h>=G)return null;var E=Z(Q,h);if(E>=65472&&E<=65534)return{u:null,M:E,offset:h};for(var a=Z(Q,n);!(a>=65472&&a<=65534);){if(++n>=G)return null;a=Z(Q,n)}return{u:E.toString(16),M:a,offset:n}}return ak.prototype={parse(Q,h){null==h&&(h={});var f=h.F,E=0,a=null,C=null,F,d,T=0;function G(){var o=Z(Q,E),B=(E+=2)+o-2,V=an(Q,B,E);V&&V.u&&(B=V.offset);var ab=Q.subarray(E,B);return E+=ab.length,ab}function n(F){for(var o=Math.ceil(F.o/8/F.X),B=Math.ceil(F.s/8/F.B),Y=0;Y<F.W.length;Y++){R=F.W[Y];var ab=Math.ceil(Math.ceil(F.o/8)*R.h/F.X),af=Math.ceil(Math.ceil(F.s/8)*R.A/F.B),ap=o*R.h,aq,ae=64*(B*R.A)*(ap+1);R.D=new Int16Array(ae),R.P=ab,R.c=af}F.m=o,F.R=B}var U=[],z=[],J=[],V=Z(Q,E);if(E+=2,65496!==V)throw new W("SOI not found");V=Z(Q,E),E+=2;markerLoop:for(;65497!==V;){var Y,u,m;switch(V){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var j=G();65504===V&&74===j[0]&&70===j[1]&&73===j[2]&&70===j[3]&&0===j[4]&&(a={version:{d:j[5],T:j[6]},K:j[7],j:j[8]<<8|j[9],H:j[10]<<8|j[11],S:j[12],I:j[13],C:j.subarray(14,14+3*j[12]*j[13])}),65518===V&&65===j[0]&&100===j[1]&&111===j[2]&&98===j[3]&&101===j[4]&&(C={version:j[5]<<8|j[6],k:j[7]<<8|j[8],q:j[9]<<8|j[10],a:j[11]});break;case 65499:for(var v,b,$=Z(Q,E)+(E+=2)-2;E<$;){var r=Q[E++],P=new Uint16Array(64);if(r>>4==0)for(u=0;u<64;u++)P[b=p[u]]=Q[E++];else{if(r>>4!=1)throw new W("DQT - invalid table spec");for(u=0;u<64;u++)P[b=p[u]]=Z(Q,E),E+=2}U[15&r]=P}break;case 65472:case 65473:case 65474:if(F)throw new W("Only single frame JPEGs supported");E+=2,(F={}).G=65473===V,F.Z=65474===V,F.precision=Q[E++];var D=Z(Q,E),a4,q=0,H=0;E+=2,F.s=f||D,F.o=Z(Q,E),E+=2,F.W=[],F._={};var a8=Q[E++];for(Y=0;Y<a8;Y++){a4=Q[E];var w=Q[E+1]>>4,y=15&Q[E+1];q<w&&(q=w),H<y&&(H=y);var X=Q[E+2];m=F.W.push({h:w,A:y,L:X,$:null}),F._[a4]=m-1,E+=3}F.X=q,F.B=H,n(F);break;case 65476:var O=Z(Q,E);for(E+=2,Y=2;Y<O;){var _=Q[E++],N=new Uint8Array(16),e=0;for(u=0;u<16;u++,E++)e+=N[u]=Q[E];var K=new Uint8Array(e);for(u=0;u<e;u++,E++)K[u]=Q[E];Y+=17+e,(_>>4==0?J:z)[15&_]=a5(N,K)}break;case 65501:d=Z(Q,E+=2),E+=2;break;case 65498:var x=1==++T&&!f,R;E+=2;var k=Q[E++],g=[];for(Y=0;Y<k;Y++){var c=Q[E++],L=F._[c];(R=F.W[L]).index=c;var a6=Q[E++];R.J=J[a6>>4],R.i=z[15&a6],g.push(R)}var I=Q[E++],l=Q[E++],M=Q[E++];try{var S=a7(Q,E,F,g,d,I,l,M>>4,15&M,x);E+=S}catch(ex){if(ex instanceof DNLMarkerError)return this.parse(Q,{F:ex.s});if(ex instanceof EOIMarkerError)break markerLoop;throw ex}break;case 65500:E+=4;break;case 65535:255!==Q[E]&&E--;break;default:var i=an(Q,E-2,E-3);if(i&&i.u){E=i.offset;break}if(E>=Q.length-1)break markerLoop;throw new W("JpegImage.parse - unknown marker: "+V.toString(16))}V=Z(Q,E),E+=2}for(this.width=F.o,this.height=F.s,this.g=a,this.b=C,this.W=[],Y=0;Y<F.W.length;Y++){var A=U[(R=F.W[Y]).L];A&&(R.$=A),this.W.push({index:R.index,e:a0(F,R),l:R.h/F.X,t:R.A/F.B,P:R.P,c:R.c})}this.p=this.W.length},Y(Q,h,f){null==f&&(f=!1);var G=this.width/Q,n=this.height/h,E,a,C,F,d,T,U,z,J,V,Y=0,u,m=this.W.length,j=Q*h*m,v=new Uint8ClampedArray(j),$=new Uint32Array(Q),b=4294967288,r;for(U=0;U<m;U++){if(a=(E=this.W[U]).l*G,C=E.t*n,Y=U,u=E.e,F=E.P+1<<3,a!==r){for(d=0;d<Q;d++)z=0|d*a,$[d]=(z&b)<<3|7&z;r=a}for(T=0;T<h;T++)for(V=F*((z=0|T*C)&b)|(7&z)<<3,d=0;d<Q;d++)v[Y]=u[V+$[d]],Y+=m}var P=this.V;if(f||4!==m||P||(P=new Int32Array([-256,255,-256,255,-256,255,-256,255])),P)for(U=0;U<j;)for(z=0,J=0;z<m;z++,U++,J+=2)v[U]=(v[U]*P[J]>>8)+P[J+1];return v},get f(){return this.b?!!this.b.a:3===this.p?0!==this.N&&(82!==this.W[0].index||71!==this.W[1].index||66!==this.W[2].index):1===this.N},z:function aj(Q){for(var h,f,G,n=0,E=Q.length;n<E;n+=3)h=Q[n],f=Q[n+1],G=Q[n+2],Q[n]=h-179.456+1.402*G,Q[n+1]=h+135.459-.344*f-.714*G,Q[n+2]=h-226.816+1.772*f;return Q},O:function aa(Q){for(var h,f,G,n,E=0,a=0,C=Q.length;a<C;a+=4)h=Q[a],f=Q[a+1],G=Q[a+2],n=Q[a+3],Q[E++]=f*(-660635669420364e-19*f+.000437130475926232*G-54080610064599e-18*h+.00048449797120281*n-.154362151871126)-122.67195406894+G*(-.000957964378445773*G+.000817076911346625*h-.00477271405408747*n+1.53380253221734)+h*(.000961250184130688*h-.00266257332283933*n+.48357088451265)+n*(-.000336197177618394*n+.484791561490776),Q[E++]=107.268039397724+f*(219927104525741e-19*f-.000640992018297945*G+.000659397001245577*h+.000426105652938837*n-.176491792462875)+G*(-.000778269941513683*G+.00130872261408275*h+.000770482631801132*n-.151051492775562)+h*(.00126935368114843*h-.00265090189010898*n+.25802910206845)+n*(-.000318913117588328*n-.213742400323665),Q[E++]=f*(-.000570115196973677*f-263409051004589e-19*G+.0020741088115012*h-.00288260236853442*n+.814272968359295)-20.810012546947+G*(-153496057440975e-19*G-.000132689043961446*h+.000560833691242812*n-.195152027534049)+h*(.00174418132927582*h-.00255243321439347*n+.116935020465145)+n*(-.000343531996510555*n+.24165260232407);return Q.subarray(0,E)},r:function a3(Q){for(var h,f,G,n=0,E=Q.length;n<E;n+=4)h=Q[n],f=Q[n+1],G=Q[n+2],Q[n]=434.456-h-1.402*G,Q[n+1]=119.541-h+.344*f+.714*G,Q[n+2]=481.816-h-1.772*f;return Q},U:function as(Q){for(var h,f,G,n,E=0,a=0,C=Q.length;a<C;a+=4)h=Q[a],f=Q[a+1],G=Q[a+2],n=Q[a+3],Q[E++]=255+h*(-6747147073602441e-20*h+.0008379262121013727*f+.0002894718188643294*G+.003264231057537806*n-1.1185611867203937)+f*(26374107616089405e-21*f-8626949158638572e-20*G-.0002748769067499491*n-.02155688794978967)+G*(-3878099212869363e-20*G-.0003267808279485286*n+.0686742238595345)-n*(.0003361971776183937*n+.7430659151342254),Q[E++]=255+h*(.00013596372813588848*h+.000924537132573585*f+.00010567359618683593*G+.0004791864687436512*n-.3109689587515875)+f*(-.00023545346108370344*f+.0002702845253534714*G+.0020200308977307156*n-.7488052167015494)+G*(6834815998235662e-20*G+.00015168452363460973*n-.09751927774728933)-n*(.0003189131175883281*n+.7364883807733168),Q[E++]=255+h*(13598650411385307e-21*h+.00012423956175490851*f+.0004751985097583589*G-36729317476630422e-22*n-.05562186980264034)+f*(.00016141380598724676*f+.0009692239130725186*G+.0007782692450036253*n-.44015232367526463)+G*(5.068882914068769e-7*G+.0017778369011375071*n-.7591454649749609)-n*(.0003435319965105553*n+.7063770186160144);return Q.subarray(0,E)},getData:function(Q){var h=Q.width,f=Q.height,G=Q.forceRGB,n=Q.isSourcePDF;if(this.p>4)throw new W("Unsupported color mode");var E=this.Y(h,f,n);if(1===this.p&&G){for(var a=E.length,C=new Uint8ClampedArray(3*a),F=0,d=0;d<a;d++){var T=E[d];C[F++]=T,C[F++]=T,C[F++]=T}return C}if(3===this.p&&this.f)return this.z(E);if(4===this.p){if(this.f)return G?this.O(E):this.r(E);if(G)return this.U(E)}return E}},ak}();function a9(p,t){return p[t]<<24>>24}function Z(p,t){return p[t]<<8|p[t+1]}function am(p,t){return(p[t]<<24|p[t+1]<<16|p[t+2]<<8|p[t+3])>>>0}UTIF.JpegDecoder=ak}(),UTIF.encodeImage=function(rgba,w,h,metadata){var idf={t256:[w],t257:[h],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[h],t279:[w*h*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(metadata)for(var i in metadata)idf[i]=metadata[i];for(var prfx=new Uint8Array(UTIF.encode([idf])),img=new Uint8Array(rgba),data=new Uint8Array(1e3+w*h*4),i=0;i<prfx.length;i++)data[i]=prfx[i];for(var i=0;i<img.length;i++)data[1e3+i]=img[i];return data.buffer},UTIF.encode=function(ifds){var LE=!1,data=new Uint8Array(2e4),offset=4,bin=UTIF._binBE;data[0]=data[1]=77,bin.writeUshort(data,2,42);var ifdo=8;bin.writeUint(data,offset,ifdo),offset+=4;for(var i=0;i<ifds.length;i++){var noffs=UTIF._writeIFD(bin,UTIF._types.basic,data,ifdo,ifds[i]);ifdo=noffs[1],i<ifds.length-1&&(0!=(3&ifdo)&&(ifdo+=4-(3&ifdo)),bin.writeUint(data,noffs[0],ifdo))}return data.slice(0,ifdo).buffer},UTIF.decode=function(buff,prm){null==prm&&(prm={parseMN:!0,debug:!1});var data=new Uint8Array(buff),offset=0,id=UTIF._binBE.readASCII(data,offset,2);offset+=2;var bin="II"==id?UTIF._binLE:UTIF._binBE,num=bin.readUshort(data,offset);offset+=2;var ifdo=bin.readUint(data,offset);offset+=4;for(var ifds=[];;){var cnt=bin.readUshort(data,ifdo),typ=bin.readUshort(data,ifdo+4);if(0!=cnt&&(typ<1||13<typ)){log("error in TIFF");break}if(UTIF._readIFD(bin,data,ifdo,ifds,0,prm),0==(ifdo=bin.readUint(data,ifdo+2+12*cnt)))break}return ifds},UTIF.decodeImage=function(buff,img,ifds){if(!img.data){var data=new Uint8Array(buff),id=UTIF._binBE.readASCII(data,0,2);if(null!=img.t256){img.isLE="II"==id,img.width=img.t256[0],img.height=img.t257[0];var cmpr=img.t259?img.t259[0]:1,fo=img.t266?img.t266[0]:1;img.t284&&2==img.t284[0]&&log("PlanarConfiguration 2 should not be used!"),7==cmpr&&img.t258&&img.t258.length>3&&(img.t258=img.t258.slice(0,3));var spp=img.t277?img.t277[0]:1,bps,bipp=(img.t258?img.t258[0]:1)*spp;1==cmpr&&null!=img.t279&&img.t278&&32803==img.t262[0]&&(bipp=Math.round(8*img.t279[0]/(img.width*img.t278[0]))),img.t50885&&4==img.t50885[0]&&(bipp=3*img.t258[0]);var bipl=8*Math.ceil(img.width*bipp/8),soff=img.t273;(null==soff||img.t322)&&(soff=img.t324);var bcnt=img.t279;1==cmpr&&1==soff.length&&(bcnt=[img.height*(bipl>>>3)]),(null==bcnt||img.t322)&&(bcnt=img.t325);var bytes=new Uint8Array(img.height*(bipl>>>3)),bilen=0;if(null!=img.t322){for(var tw=img.t322[0],th=img.t323[0],tx=Math.floor((img.width+tw-1)/tw),ty=Math.floor((img.height+th-1)/th),tbuff=new Uint8Array(0|Math.ceil(tw*th*bipp/8)),y=0;y<ty;y++)for(var x=0;x<tx;x++){var i=y*tx+x;tbuff.fill(0),UTIF.decode._decompress(img,ifds,data,soff[i],bcnt[i],cmpr,tbuff,0,fo),6==cmpr?bytes=tbuff:UTIF._copyTile(tbuff,0|Math.ceil(tw*bipp/8),th,bytes,0|Math.ceil(img.width*bipp/8),img.height,0|Math.ceil(x*tw*bipp/8),y*th)}bilen=8*bytes.length}else{if(null==soff)return;var rps=img.t278?img.t278[0]:img.height;rps=Math.min(rps,img.height);for(var i=0;i<soff.length;i++)UTIF.decode._decompress(img,ifds,data,soff[i],bcnt[i],cmpr,bytes,0|Math.ceil(bilen/8),fo),bilen+=bipl*rps;bilen=Math.min(bilen,8*bytes.length)}img.data=new Uint8Array(bytes.buffer,0,0|Math.ceil(bilen/8))}}},UTIF.decode._decompress=function(img,ifds,data,off,len,cmpr,tgt,toff,fo){if(img.t271&&"Panasonic"==img.t271[0]&&img.t45&&6==img.t45[0]&&(cmpr=34316),1==cmpr)for(var j=0;j<len;j++)tgt[toff+j]=data[off+j];else if(2==cmpr)UTIF.decode._decodeG2(data,off,len,tgt,toff,img.width,fo);else if(3==cmpr)UTIF.decode._decodeG3(data,off,len,tgt,toff,img.width,fo,!!img.t292&&1==(1&img.t292[0]));else if(4==cmpr)UTIF.decode._decodeG4(data,off,len,tgt,toff,img.width,fo);else if(5==cmpr)UTIF.decode._decodeLZW(data,off,len,tgt,toff,8);else if(6==cmpr)UTIF.decode._decodeOldJPEG(img,data,off,len,tgt,toff);else if(7==cmpr||34892==cmpr)UTIF.decode._decodeNewJPEG(img,data,off,len,tgt,toff);else if(8==cmpr||32946==cmpr){var src=new Uint8Array(data.buffer,off+2,len-6),bin=pako.inflateRaw(src);toff+bin.length<tgt.length&&tgt.set(bin,toff)}else 9==cmpr?UTIF.decode._decodeVC5(data,off,len,tgt,toff,img.t33422):32767==cmpr?UTIF.decode._decodeARW(img,data,off,len,tgt,toff):32773==cmpr?UTIF.decode._decodePackBits(data,off,len,tgt,toff):32809==cmpr?UTIF.decode._decodeThunder(data,off,len,tgt,toff):34316==cmpr?UTIF.decode._decodePanasonic(img,data,off,len,tgt,toff):34713==cmpr?UTIF.decode._decodeNikon(img,ifds,data,off,len,tgt,toff):34676==cmpr?UTIF.decode._decodeLogLuv32(img,data,off,len,tgt,toff):log("Unknown compression",cmpr);var bps=img.t258?Math.min(32,img.t258[0]):1,noc=img.t277?img.t277[0]:1,bpp=bps*noc>>>3,h=img.t278?img.t278[0]:img.height,bpl=Math.ceil(bps*noc*img.width/8);if(16==bps&&!img.isLE&&null==img.t33422)for(var y=0;y<h;y++)for(var roff=toff+y*bpl,x=1;x<bpl;x+=2){var t=tgt[roff+x];tgt[roff+x]=tgt[roff+x-1],tgt[roff+x-1]=t}if(img.t317&&2==img.t317[0])for(var y=0;y<h;y++){var ntoff=toff+y*bpl;if(16==bps)for(var j=bpp;j<bpl;j+=2){var nv=(tgt[ntoff+j+1]<<8|tgt[ntoff+j])+(tgt[ntoff+j-bpp+1]<<8|tgt[ntoff+j-bpp]);tgt[ntoff+j]=255&nv,tgt[ntoff+j+1]=nv>>>8&255}else if(3==noc)for(var j=3;j<bpl;j+=3)tgt[ntoff+j]=tgt[ntoff+j]+tgt[ntoff+j-3]&255,tgt[ntoff+j+1]=tgt[ntoff+j+1]+tgt[ntoff+j-2]&255,tgt[ntoff+j+2]=tgt[ntoff+j+2]+tgt[ntoff+j-1]&255;else for(var j=bpp;j<bpl;j++)tgt[ntoff+j]=tgt[ntoff+j]+tgt[ntoff+j-bpp]&255}},UTIF.decode._decodePanasonic=function(img,data,off,len,tgt,toff){var img_buffer=data.buffer,rawWidth=img.t2[0],rawHeight=img.t3[0],bitsPerSample=img.t10[0],RW2_Format=img.t45[0],bidx=0,imageIndex=0,vpos=0,byte=0,arr_a,arr_b,bytes=6==RW2_Format?new Uint32Array(18):new Uint8Array(16),i,j,sh,pred=[0,0],nonz=[0,0],isOdd,idx=0,pixel_base,row,col,crow,buffer=new Uint8Array(16384),result=new Uint16Array(tgt.buffer);function getDataRaw(bits){if(0==vpos){var arr_a=new Uint8Array(img_buffer,off+imageIndex+8184,8200),arr_b=new Uint8Array(img_buffer,off+imageIndex,8184);buffer.set(arr_a),buffer.set(arr_b,arr_a.length),imageIndex+=16384}if(5!=RW2_Format)return(buffer[byte=(vpos=vpos-bits&131071)>>3^16368]|buffer[byte+1]<<8)>>(7&vpos)&~(-1<<bits);for(i=0;i<16;i++)bytes[i]=buffer[vpos++],vpos&=16383}function getBufferDataRW6(i){return buffer[vpos+15-i]}function readPageRW6(){bytes[0]=getBufferDataRW6(0)<<6|getBufferDataRW6(1)>>2,bytes[1]=16383&((3&getBufferDataRW6(1))<<12|getBufferDataRW6(2)<<4|getBufferDataRW6(3)>>4),bytes[2]=getBufferDataRW6(3)>>2&3,bytes[3]=(3&getBufferDataRW6(3))<<8|getBufferDataRW6(4),bytes[4]=getBufferDataRW6(5)<<2|getBufferDataRW6(6)>>6,bytes[5]=(63&getBufferDataRW6(6))<<4|getBufferDataRW6(7)>>4,bytes[6]=getBufferDataRW6(7)>>2&3,bytes[7]=(3&getBufferDataRW6(7))<<8|getBufferDataRW6(8),bytes[8]=getBufferDataRW6(9)<<2&1020|getBufferDataRW6(10)>>6,bytes[9]=1023&(getBufferDataRW6(10)<<4|getBufferDataRW6(11)>>4),bytes[10]=getBufferDataRW6(11)>>2&3,bytes[11]=(3&getBufferDataRW6(11))<<8|getBufferDataRW6(12),bytes[12]=1023&(getBufferDataRW6(13)<<2&1020|getBufferDataRW6(14)>>6),bytes[13]=1023&(getBufferDataRW6(14)<<4|getBufferDataRW6(15)>>4),vpos+=16,byte=0}function readPageRw6_bps12(){bytes[0]=getBufferDataRW6(0)<<4|getBufferDataRW6(1)>>4,bytes[1]=4095&((15&getBufferDataRW6(1))<<8|getBufferDataRW6(2)),bytes[2]=getBufferDataRW6(3)>>6&3,bytes[3]=(63&getBufferDataRW6(3))<<2|getBufferDataRW6(4)>>6,bytes[4]=(63&getBufferDataRW6(4))<<2|getBufferDataRW6(5)>>6,bytes[5]=(63&getBufferDataRW6(5))<<2|getBufferDataRW6(6)>>6,bytes[6]=getBufferDataRW6(6)>>4&3,bytes[7]=(15&getBufferDataRW6(6))<<4|getBufferDataRW6(7)>>4,bytes[8]=(15&getBufferDataRW6(7))<<4|getBufferDataRW6(8)>>4,bytes[9]=(15&getBufferDataRW6(8))<<4|getBufferDataRW6(9)>>4,bytes[10]=getBufferDataRW6(9)>>2&3,bytes[11]=(3&getBufferDataRW6(9))<<6|getBufferDataRW6(10)>>2,bytes[12]=(3&getBufferDataRW6(10))<<6|getBufferDataRW6(11)>>2,bytes[13]=(3&getBufferDataRW6(11))<<6|getBufferDataRW6(12)>>2,bytes[14]=3&getBufferDataRW6(12),bytes[15]=getBufferDataRW6(13),bytes[16]=getBufferDataRW6(14),bytes[17]=getBufferDataRW6(15),vpos+=16,byte=0}function resetPredNonzeros(){pred[0]=0,pred[1]=0,nonz[0]=0,nonz[1]=0}if(7==RW2_Format)throw RW2_Format;if(6==RW2_Format){var is12bit=12==bitsPerSample,readPageRw6Fn=is12bit?readPageRw6_bps12:readPageRW6,pixelsPerBlock=is12bit?14:11,pixelbase0=is12bit?128:512,pixelbase_compare=is12bit?2048:8192,spix_compare=is12bit?16383:65535,pixel_mask=is12bit?4095:16383,blocksperrow=rawWidth/pixelsPerBlock,rowbytes=16*blocksperrow,bufferSize=is12bit?18:14;for(row=0;row<rawHeight-15;row+=16){var rowstoread=Math.min(16,rawHeight-row),readlen=rowbytes*rowstoread;for(buffer=new Uint8Array(img_buffer,off+bidx,readlen),vpos=0,bidx+=readlen,crow=0,col=0;crow<rowstoread;crow++,col=0){idx=(row+crow)*rawWidth;for(var rblock=0;rblock<blocksperrow;rblock++)for(readPageRw6Fn(),resetPredNonzeros(),sh=0,pixel_base=0,i=0;i<pixelsPerBlock;i++){if(isOdd=1&i,i%3==2){var base=byte<bufferSize?bytes[byte++]:0;3==base&&(base=4),pixel_base=pixelbase0<<base,sh=1<<base}var epixel=byte<bufferSize?bytes[byte++]:0;pred[isOdd]?(epixel*=sh,pixel_base<pixelbase_compare&&nonz[isOdd]>pixel_base&&(epixel+=nonz[isOdd]-pixel_base),nonz[isOdd]=epixel):(pred[isOdd]=epixel,epixel?nonz[isOdd]=epixel:epixel=nonz[isOdd]),result[idx+col++]=epixel-15<=spix_compare?epixel-15&spix_compare:epixel+2147483633>>31&pixel_mask}}}}else if(5==RW2_Format){var blockSize=12==bitsPerSample?10:9;for(row=0;row<rawHeight;row++)for(col=0;col<rawWidth;col+=blockSize)getDataRaw(0),12==bitsPerSample?(result[idx++]=((15&bytes[1])<<8)+bytes[0],result[idx++]=16*bytes[2]+(bytes[1]>>4),result[idx++]=((15&bytes[4])<<8)+bytes[3],result[idx++]=16*bytes[5]+(bytes[4]>>4),result[idx++]=((15&bytes[7])<<8)+bytes[6],result[idx++]=16*bytes[8]+(bytes[7]>>4),result[idx++]=((15&bytes[10])<<8)+bytes[9],result[idx++]=16*bytes[11]+(bytes[10]>>4),result[idx++]=((15&bytes[13])<<8)+bytes[12],result[idx++]=16*bytes[14]+(bytes[13]>>4)):14==bitsPerSample&&(result[idx++]=bytes[0]+((63&bytes[1])<<8),result[idx++]=(bytes[1]>>6)+4*bytes[2]+((15&bytes[3])<<10),result[idx++]=(bytes[3]>>4)+16*bytes[4]+((3&bytes[5])<<12),result[idx++]=((252&bytes[5])>>2)+(bytes[6]<<6),result[idx++]=bytes[7]+((63&bytes[8])<<8),result[idx++]=(bytes[8]>>6)+4*bytes[9]+((15&bytes[10])<<10),result[idx++]=(bytes[10]>>4)+16*bytes[11]+((3&bytes[12])<<12),result[idx++]=((252&bytes[12])>>2)+(bytes[13]<<6),result[idx++]=bytes[14]+((63&bytes[15])<<8))}else{if(4!=RW2_Format)throw RW2_Format;for(row=0;row<rawHeight;row++)for(col=0;col<rawWidth;col++)isOdd=1&(i=col%14),0==i&&resetPredNonzeros(),i%3==2&&(sh=4>>3-getDataRaw(2)),nonz[isOdd]?0!=(j=getDataRaw(8))&&(pred[isOdd]-=128<<sh,(pred[isOdd]<0||4==sh)&&(pred[isOdd]&=~(-1<<sh)),pred[isOdd]+=j<<sh):(nonz[isOdd]=getDataRaw(8),(nonz[isOdd]||i>11)&&(pred[isOdd]=nonz[isOdd]<<4|getDataRaw(4))),result[idx++]=pred[1&col]}},UTIF.decode._decodeVC5=function(){var x=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],o,C,k,P=[3,3,3,3,2,2,2,1,1,1],V=24576,ar,H=8192,az=16384|H;function d(t){var E=t[1],h=t[0][E>>>3]>>>7-(7&E)&1;return t[1]++,h}function ag(t,E){if(null==o){o={};for(var h=0;h<x.length;h+=4)o[x[h+1]]=x.slice(h,h+4)}for(var L=d(t),g=o[L];null==g;)L=L<<1|d(t),g=o[L];var n=g[3];0!=n&&(n=0==d(t)?n:-n),E[0]=g[2],E[1]=n}function m(t,E){for(var h=0;h<E;h++)1==(1&t)&&t++,t>>>=1;return t}function A(t,E){return t>>E}function O(t,E,h,L,g,n){E[h]=A(A(11*t[g]-4*t[g+n]+t[g+n+n]+4,3)+t[L],1),E[h+n]=A(A(5*t[g]+4*t[g+n]-t[g+n+n]+4,3)-t[L],1)}function J(t,E,h,L,g,n){var W=t[g-n]-t[g+n],j=t[g],$=t[L];E[h]=A(A(W+4,3)+j+$,1),E[h+n]=A(A(4-W,3)+j-$,1)}function y(t,E,h,L,g,n){E[h]=A(A(5*t[g]+4*t[g-n]-t[g-n-n]+4,3)+t[L],1),E[h+n]=A(A(11*t[g]-4*t[g-n]+t[g-n-n]+4,3)-t[L],1)}function q(t){return t=k[t=t<0?0:t>4095?4095:t]>>>2}function av(t,E,h,L,g,n){L=new Uint16Array(L.buffer);var W=Date.now(),j=UTIF._binBE,$=E+h,r,u,X,I,ax,a3,R,ai,aa,ap,ah,ae,aD,al,i,aE,T,B;E+=4;for(var a5=1==n[0];E<$;){var S=j.readShort(t,E),s=j.readUshort(t,E+2);if(E+=4,12==S)r=s;else if(20==S)u=s;else if(21==S)X=s;else if(48==S)I=s;else if(53==S)ax=s;else if(35==S)a3=s;else if(62==S)R=s;else if(101==S)ai=s;else if(109==S)aa=s;else if(84==S)ap=s;else if(106==S)ah=s;else if(107==S)ae=s;else if(108==S)aD=s;else if(102==S)al=s;else if(104==S)i=s;else if(105==S)aE=s;else{var F=S<0?-S:S,D=65280&F,_=0;if(F&az&&(F&H?(_=65535&s,_+=(255&F)<<16):_=65535&s),(F&V)==V){if(null==T){T=[];for(var M=0;M<4;M++)T[M]=new Int16Array((u>>>1)*(X>>>1));B=new Int16Array((u>>>1)*(X>>>1)),C=new Int16Array(1024);for(var M=0;M<1024;M++){var aG=M-512,p=Math.abs(aG),r=Math.floor(768*p*p*p/16581375)+p;C[M]=Math.sign(aG)*r}k=new Uint16Array(4096);for(var aA=65535,M=0;M<4096;M++){var at=M,a1=aA*(Math.pow(113,at/4095)-1)/112;k[M]=Math.min(a1,aA)}}var w=T[R],v=m(u,1+P[I]),N=m(X,1+P[I]);if(0==I)for(var b=0;b<N;b++)for(var G=0;G<v;G++){var c=E+2*(b*v+G);w[b*(u>>>1)+G]=t[c]<<8|t[c+1]}else{for(var a7=[t,8*E],a4=[],ay=0,aw=v*N,f=[0,0],Q=0,s=0;ay<aw;)for(ag(a7,f),Q=f[0],s=f[1];Q>0;)a4[ay++]=s,Q--;for(var l=(I-1)%3,aF=1!=l?v:0,a2=0!=l?N:0,b=0;b<N;b++)for(var af=(b+a2)*(u>>>1)+aF,au=b*v,G=0;G<v;G++)w[af+G]=C[a4[au+G]+512]*ax;if(2==l){for(var i=u>>>1,an=2*v,a9=2*N,b=0;b<N;b++)for(var G=0;G<an;G++){var M=2*b*i+G,a,e=N*i+(a=b*i+G);0==b?O(w,B,M,e,a,i):b==N-1?y(w,B,M,e,a,i):J(w,B,M,e,a,i)}var Z=w;w=B,B=Z;for(var b=0;b<a9;b++)for(var G=0;G<v;G++){var M=b*i+2*G,a,e=v+(a=b*i+G);0==G?O(w,B,M,e,a,1):G==v-1?y(w,B,M,e,a,1):J(w,B,M,e,a,1)}var Z=w;w=B,B=Z;for(var aC=[],aB=2-~~((I-1)/3),K=0;K<3;K++)aC[K]=aa>>14-2*K&3;var a6=aC[aB];if(0!=a6)for(var b=0;b<a9;b++)for(var G=0;G<an;G++){var M;w[M=b*i+G]=w[M]<<a6}}}if(9==I&&3==R)for(var a8=T[0],ab=T[1],aq=T[2],as=T[3],b=0;b<X;b+=2)for(var G=0;G<u;G+=2){var U=b*u+G,c,z=a8[c=(b>>>1)*(u>>>1)+(G>>>1)],ao=ab[c]-2048,ak=aq[c]-2048,ad=as[c]-2048,aj=(ao<<1)+z,a0=(ak<<1)+z,aH=z+ad,am=z-ad;a5?(L[U]=q(aH),L[U+1]=q(a0),L[U+u]=q(aj),L[U+u+1]=q(am)):(L[U]=q(aj),L[U+1]=q(aH),L[U+u]=q(am),L[U+u+1]=q(a0))}E+=4*_}else if(16388==F)E+=4*_;else if(8192!=D&&8448!=D&&9216!=D)throw F.toString(16)}}console.log(Date.now()-W)}return av}(),UTIF.decode._decodeLogLuv32=function(img,data,off,len,tgt,toff){for(var w=img.width,qw=4*w,io=0,out=new Uint8Array(qw);io<len;){for(var oo=0;oo<qw;){var c=data[off+io];if(io++,c<128){for(var j=0;j<c;j++)out[oo+j]=data[off+io+j];oo+=c,io+=c}else{c-=126;for(var j=0;j<c;j++)out[oo+j]=data[off+io];oo+=c,io++}}for(var x=0;x<w;x++)tgt[toff+0]=out[x],tgt[toff+1]=out[x+w],tgt[toff+2]=out[x+2*w],tgt[toff+4]=out[x+3*w],toff+=6}},UTIF.decode._ljpeg_diff=function(data,prm,huff){var getbithuff=UTIF.decode._getbithuff,len,diff;return len=getbithuff(data,prm,huff[0],huff),0==((diff=getbithuff(data,prm,len,0))&1<<len-1)&&(diff-=(1<<len)-1),diff},UTIF.decode._decodeARW=function(img,inp,off,src_length,tgt,toff){var raw_width=img.t256[0],height=img.t257[0],tiff_bps=img.t258[0],bin=img.isLE?UTIF._binLE:UTIF._binBE,arw2;if(raw_width*height==src_length||raw_width*height*1.5==src_length)if(raw_width*height*1.5!=src_length){var pix=new Uint16Array(16),row,col,val,max,min,imax,imin,sh,bit,i,dp,data=new Uint8Array(raw_width+1);for(row=0;row<height;row++){for(var j=0;j<raw_width;j++)data[j]=inp[off++];for(dp=0,col=0;col<raw_width-30;dp+=16){for(max=2047&(val=bin.readUint(data,dp)),min=2047&val>>>11,imax=15&val>>>22,imin=15&val>>>26,sh=0;sh<4&&128<<sh<=max-min;sh++);for(bit=30,i=0;i<16;i++)i==imax?pix[i]=max:i==imin?pix[i]=min:(pix[i]=((bin.readUshort(data,dp+(bit>>3))>>>(7&bit)&127)<<sh)+min,pix[i]>2047&&(pix[i]=2047),bit+=7);for(i=0;i<16;i++,col+=2){var clr=pix[i]<<1;UTIF.decode._putsF(tgt,(row*raw_width+col)*tiff_bps,clr<<16-tiff_bps)}col-=1&col?1:31}}}else for(var i=0;i<src_length;i+=3){var b0=inp[off+i+0],b1=inp[off+i+1],b2=inp[off+i+2];tgt[toff+i]=b1<<4|b0>>>4,tgt[toff+i+1]=b0<<4|b2>>>4,tgt[toff+i+2]=b2<<4|b1>>>4}else{height+=8;var prm=[off,0,0,0],huff=new Uint16Array(32770),tab=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],i,c,n,col,row,sum=0,ljpeg_diff=UTIF.decode._ljpeg_diff;for(huff[0]=15,n=i=0;i<18;i++)for(var lim=32768>>>(tab[i]>>>8),c=0;c<lim;c++)huff[++n]=tab[i];for(col=raw_width;col--;)for(row=0;row<height+1;row+=2)if(row==height&&(row=1),sum+=ljpeg_diff(inp,prm,huff),row<height){var clr=4095&sum;UTIF.decode._putsF(tgt,(row*raw_width+col)*tiff_bps,clr<<16-tiff_bps)}}},UTIF.decode._decodeNikon=function(img,imgs,data,off,src_length,tgt,toff){var nikon_tree=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],raw_width=img.t256[0],height=img.t257[0],tiff_bps=img.t258[0],tree=0,split=0,make_decoder=UTIF.decode._make_decoder,getbithuff=UTIF.decode._getbithuff,mn=imgs[0].exifIFD.makerNote,md=mn.t150?mn.t150:mn.t140,mdo=0,ver0=md[mdo++],ver1=md[mdo++];73!=ver0&&88!=ver1||(mdo+=2110),70==ver0&&(tree=2),14==tiff_bps&&(tree+=3);for(var vpred=[[0,0],[0,0]],bin=img.isLE?UTIF._binLE:UTIF._binBE,i=0;i<2;i++)for(var j=0;j<2;j++)vpred[i][j]=bin.readShort(md,mdo),mdo+=2;var max=1<<tiff_bps&32767,step=0,csize=bin.readShort(md,mdo),i,row,col,len,shl,diff;mdo+=2,csize>1&&(step=Math.floor(max/(csize-1))),68==ver0&&32==ver1&&step>0&&(split=bin.readShort(md,562));var min_v=0,hpred=[0,0],huff=make_decoder(nikon_tree[tree]),prm=[off,0,0,0];for(min_v=row=0;row<height;row++)for(split&&row==split&&(huff=make_decoder(nikon_tree[tree+1])),col=0;col<raw_width;col++){i=getbithuff(data,prm,huff[0],huff),0==((diff=1+(getbithuff(data,prm,(len=15&i)-(shl=i>>>4),0)<<1)<<shl>>>1)&1<<len-1)&&(diff-=(1<<len)-(0==shl?1:0)),col<2?hpred[col]=vpred[1&row][col]+=diff:hpred[1&col]+=diff;var clr=Math.min(Math.max(hpred[1&col],0),(1<<tiff_bps)-1),bti=(row*raw_width+col)*tiff_bps;UTIF.decode._putsF(tgt,bti,clr<<16-tiff_bps)}},UTIF.decode._putsF=function(dt,pos,val){val<<=8-(7&pos);var o=pos>>>3;dt[o]|=val>>>16,dt[o+1]|=val>>>8,dt[o+2]|=val},UTIF.decode._getbithuff=function(data,prm,nbits,huff){var zero_after_ff=0,get_byte=UTIF.decode._get_byte,c,off=prm[0],bitbuf=prm[1],vbits=prm[2],reset=prm[3];if(0==nbits||vbits<0)return 0;for(;!reset&&vbits<nbits&&-1!=(c=data[off++])&&!(reset=0);)bitbuf=(bitbuf<<8)+c,vbits+=8;if(c=bitbuf<<32-vbits>>>32-nbits,huff?(vbits-=huff[c+1]>>>8,c=255&huff[c+1]):vbits-=nbits,vbits<0)throw"e";return prm[0]=off,prm[1]=bitbuf,prm[2]=vbits,prm[3]=reset,c},UTIF.decode._make_decoder=function(source){var max,len,h,i,j,huff=[];for(max=16;0!=max&&!source[max];max--);var si=17;for(huff[0]=max,h=len=1;len<=max;len++)for(i=0;i<source[len];i++,++si)for(j=0;j<1<<max-len;j++)h<=1<<max&&(huff[h++]=len<<8|source[si]);return huff},UTIF.decode._decodeNewJPEG=function(img,data,off,len,tgt,toff){len=Math.min(len,data.length-off);var tables=img.t347,tlen=tables?tables.length:0,buff=new Uint8Array(tlen+len);if(tables){for(var SOI=216,EOI=217,boff=0,i=0;i<tlen-1&&(255!=tables[i]||217!=tables[i+1]);i++)buff[boff++]=tables[i];var byte1=data[off],byte2=data[off+1];255==byte1&&216==byte2||(buff[boff++]=byte1,buff[boff++]=byte2);for(var i=2;i<len;i++)buff[boff++]=data[off+i]}else for(var i=0;i<len;i++)buff[i]=data[off+i];if(32803==img.t262[0]||7==img.t259[0]&&34892==img.t262[0]){var bps=img.t258[0],out=UTIF.LosslessJpegDecode(buff),olen=out.length;if(16==bps)if(img.isLE)for(var i=0;i<olen;i++)tgt[toff+(i<<1)]=255&out[i],tgt[toff+(i<<1)+1]=out[i]>>>8;else for(var i=0;i<olen;i++)tgt[toff+(i<<1)]=out[i]>>>8,tgt[toff+(i<<1)+1]=255&out[i];else if(14==bps||12==bps||10==bps)for(var rst=16-bps,i=0;i<olen;i++)UTIF.decode._putsF(tgt,i*bps,out[i]<<rst);else{if(8!=bps)throw new Error("unsupported bit depth "+bps);for(var i=0;i<olen;i++)tgt[toff+i]=out[i]}}else{var parser=new UTIF.JpegDecoder;parser.parse(buff);for(var decoded=parser.getData({width:parser.width,height:parser.height,forceRGB:!0,isSourcePDF:!1}),i=0;i<decoded.length;i++)tgt[toff+i]=decoded[i]}6==img.t262[0]&&(img.t262[0]=2)},UTIF.decode._decodeOldJPEGInit=function(img,data,off,len){var SOI=216,EOI=217,DQT=219,DHT=196,DRI=221,SOF0=192,SOS=218,joff=0,soff=0,tables,sosMarker,isTiled=!1,i,j,k,jpgIchgFmt=img.t513,jifoff=jpgIchgFmt?jpgIchgFmt[0]:0,jpgIchgFmtLen=img.t514,jiflen=jpgIchgFmtLen?jpgIchgFmtLen[0]:0,soffTag=img.t324||img.t273||jpgIchgFmt,ycbcrss=img.t530,ssx=0,ssy=0,spp=img.t277?img.t277[0]:1,jpgresint=img.t515;if(soffTag&&(soff=soffTag[0],isTiled=soffTag.length>1),!isTiled){if(255==data[off]&&216==data[off+1])return{jpegOffset:off};if(null!=jpgIchgFmt&&(255==data[off+jifoff]&&216==data[off+jifoff+1]?joff=off+jifoff:log("JPEGInterchangeFormat does not point to SOI"),null==jpgIchgFmtLen?log("JPEGInterchangeFormatLength field is missing"):(jifoff>=soff||jifoff+jiflen<=soff)&&log("JPEGInterchangeFormatLength field value is invalid"),null!=joff))return{jpegOffset:joff}}if(null!=ycbcrss&&(ssx=ycbcrss[0],ssy=ycbcrss[1]),null!=jpgIchgFmt&&null!=jpgIchgFmtLen)if(jiflen>=2&&jifoff+jiflen<=soff){for(tables=255==data[off+jifoff+jiflen-2]&&216==data[off+jifoff+jiflen-1]?new Uint8Array(jiflen-2):new Uint8Array(jiflen),i=0;i<tables.length;i++)tables[i]=data[off+jifoff+i];log("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else log("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(null==tables){var ooff=0,out=[];out[ooff++]=255,out[ooff++]=216;var qtables=img.t519;if(null==qtables)throw new Error("JPEGQTables tag is missing");for(i=0;i<qtables.length;i++)for(out[ooff++]=255,out[ooff++]=219,out[ooff++]=0,out[ooff++]=67,out[ooff++]=i,j=0;j<64;j++)out[ooff++]=data[off+qtables[i]+j];for(k=0;k<2;k++){var htables=img[0==k?"t520":"t521"];if(null==htables)throw new Error((0==k?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(i=0;i<htables.length;i++){out[ooff++]=255,out[ooff++]=196;var nc=19;for(j=0;j<16;j++)nc+=data[off+htables[i]+j];for(out[ooff++]=nc>>>8,out[ooff++]=255&nc,out[ooff++]=i|k<<4,j=0;j<16;j++)out[ooff++]=data[off+htables[i]+j];for(j=0;j<nc;j++)out[ooff++]=data[off+htables[i]+16+j]}}if(out[ooff++]=255,out[ooff++]=192,out[ooff++]=0,out[ooff++]=8+3*spp,out[ooff++]=8,out[ooff++]=img.height>>>8&255,out[ooff++]=255&img.height,out[ooff++]=img.width>>>8&255,out[ooff++]=255&img.width,out[ooff++]=spp,1==spp)out[ooff++]=1,out[ooff++]=17,out[ooff++]=0;else for(i=0;i<3;i++)out[ooff++]=i+1,out[ooff++]=0!=i?17:(15&ssx)<<4|15&ssy,out[ooff++]=i;null!=jpgresint&&0!=jpgresint[0]&&(out[ooff++]=255,out[ooff++]=221,out[ooff++]=0,out[ooff++]=4,out[ooff++]=jpgresint[0]>>>8&255,out[ooff++]=255&jpgresint[0]),tables=new Uint8Array(out)}var sofpos=-1;for(i=0;i<tables.length-1;){if(255==tables[i]&&192==tables[i+1]){sofpos=i;break}i++}if(-1==sofpos){var tmptab=new Uint8Array(tables.length+10+3*spp);tmptab.set(tables);var tmpoff=tables.length;if(sofpos=tables.length,(tables=tmptab)[tmpoff++]=255,tables[tmpoff++]=192,tables[tmpoff++]=0,tables[tmpoff++]=8+3*spp,tables[tmpoff++]=8,tables[tmpoff++]=img.height>>>8&255,tables[tmpoff++]=255&img.height,tables[tmpoff++]=img.width>>>8&255,tables[tmpoff++]=255&img.width,tables[tmpoff++]=spp,1==spp)tables[tmpoff++]=1,tables[tmpoff++]=17,tables[tmpoff++]=0;else for(i=0;i<3;i++)tables[tmpoff++]=i+1,tables[tmpoff++]=0!=i?17:(15&ssx)<<4|15&ssy,tables[tmpoff++]=i}if(255==data[soff]&&218==data[soff+1]){var soslen=data[soff+2]<<8|data[soff+3];for((sosMarker=new Uint8Array(soslen+2))[0]=data[soff],sosMarker[1]=data[soff+1],sosMarker[2]=data[soff+2],sosMarker[3]=data[soff+3],i=0;i<soslen-2;i++)sosMarker[i+4]=data[soff+i+4]}else{var sosoff=0;if((sosMarker=new Uint8Array(8+2*spp))[sosoff++]=255,sosMarker[sosoff++]=218,sosMarker[sosoff++]=0,sosMarker[sosoff++]=6+2*spp,sosMarker[sosoff++]=spp,1==spp)sosMarker[sosoff++]=1,sosMarker[sosoff++]=0;else for(i=0;i<3;i++)sosMarker[sosoff++]=i+1,sosMarker[sosoff++]=i<<4|i;sosMarker[sosoff++]=0,sosMarker[sosoff++]=63,sosMarker[sosoff++]=0}return{jpegOffset:off,tables:tables,sosMarker:sosMarker,sofPosition:sofpos}},UTIF.decode._decodeOldJPEG=function(img,data,off,len,tgt,toff){var i,dlen,tlen,buff,buffoff,jpegData=UTIF.decode._decodeOldJPEGInit(img,data,off,len);if(null!=jpegData.jpegOffset)for(dlen=off+len-jpegData.jpegOffset,buff=new Uint8Array(dlen),i=0;i<dlen;i++)buff[i]=data[jpegData.jpegOffset+i];else{for(tlen=jpegData.tables.length,(buff=new Uint8Array(tlen+jpegData.sosMarker.length+len+2)).set(jpegData.tables),buffoff=tlen,buff[jpegData.sofPosition+5]=img.height>>>8&255,buff[jpegData.sofPosition+6]=255&img.height,buff[jpegData.sofPosition+7]=img.width>>>8&255,buff[jpegData.sofPosition+8]=255&img.width,255==data[off]&&data[off+1]==SOS||(buff.set(jpegData.sosMarker,buffoff),buffoff+=sosMarker.length),i=0;i<len;i++)buff[buffoff++]=data[off+i];buff[buffoff++]=255,buff[buffoff++]=EOI}var parser=new UTIF.JpegDecoder;parser.parse(buff);for(var decoded=parser.getData({width:parser.width,height:parser.height,forceRGB:!0,isSourcePDF:!1}),i=0;i<decoded.length;i++)tgt[toff+i]=decoded[i];img.t262&&6==img.t262[0]&&(img.t262[0]=2)},UTIF.decode._decodePackBits=function(data,off,len,tgt,toff){for(var sa=new Int8Array(data.buffer),ta=new Int8Array(tgt.buffer),lim=off+len;off<lim;){var n=sa[off];if(off++,n>=0&&n<128)for(var i=0;i<n+1;i++)ta[toff]=sa[off],toff++,off++;if(n>=-127&&n<0){for(var i=0;i<1-n;i++)ta[toff]=sa[off],toff++;off++}}return toff},UTIF.decode._decodeThunder=function(data,off,len,tgt,toff){for(var d2=[0,1,0,-1],d3=[0,1,2,3,0,-3,-2,-1],lim=off+len,qoff=2*toff,px=0;off<lim;){var b=data[off],msk=b>>>6,n=63&b;if(off++,3==msk&&(px=15&n,tgt[qoff>>>1]|=px<<4*(1-qoff&1),qoff++),0==msk)for(var i=0;i<n;i++)tgt[qoff>>>1]|=px<<4*(1-qoff&1),qoff++;if(2==msk)for(var i=0;i<2;i++){var d;4!=(d=n>>>3*(1-i)&7)&&(px+=d3[d],tgt[qoff>>>1]|=px<<4*(1-qoff&1),qoff++)}if(1==msk)for(var i=0;i<3;i++){var d;2!=(d=n>>>2*(2-i)&3)&&(px+=d2[d],tgt[qoff>>>1]|=px<<4*(1-qoff&1),qoff++)}}},UTIF.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},UTIF.decode._lens=function(){var addKeys=function(lens,arr,i0,inc){for(var i=0;i<arr.length;i++)lens[arr[i]]=i0+i*inc},termW="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",termB="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",makeW="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",makeB="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",makeA="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";termW=termW.split(","),termB=termB.split(","),makeW=makeW.split(","),makeB=makeB.split(","),makeA=makeA.split(",");var lensW={},lensB={};return addKeys(lensW,termW,0,1),addKeys(lensW,makeW,64,64),addKeys(lensW,makeA,1792,64),addKeys(lensB,termB,0,1),addKeys(lensB,makeB,64,64),addKeys(lensB,makeA,1792,64),[lensW,lensB]}(),UTIF.decode._decodeG4=function(data,off,slen,tgt,toff,w,fo){for(var U=UTIF.decode,boff=off<<3,len=0,wrd="",line=[],pline=[],i=0;i<w;i++)pline.push(0);pline=U._makeDiff(pline);for(var a0=0,a1=0,a2=0,b1=0,b2=0,clr=0,y=0,mode="",toRead=0,bipl=8*Math.ceil(w/8);boff>>>3<off+slen;){b1=U._findDiff(pline,a0+(0==a0?0:1),1-clr),b2=U._findDiff(pline,b1,clr);var bit=0;if(1==fo&&(bit=data[boff>>>3]>>>7-(7&boff)&1),2==fo&&(bit=data[boff>>>3]>>>(7&boff)&1),boff++,wrd+=bit,"H"==mode){if(null!=U._lens[clr][wrd]){var dl=U._lens[clr][wrd];wrd="",len+=dl,dl<64&&(U._addNtimes(line,len,clr),a0+=len,clr=1-clr,len=0,0==--toRead&&(mode=""))}}else"0001"==wrd&&(wrd="",U._addNtimes(line,b2-a0,clr),a0=b2),"001"==wrd&&(wrd="",mode="H",toRead=2),null!=U._dmap[wrd]&&(a1=b1+U._dmap[wrd],U._addNtimes(line,a1-a0,clr),a0=a1,wrd="",clr=1-clr);line.length==w&&""==mode&&(U._writeBits(line,tgt,8*toff+y*bipl),clr=0,y++,a0=0,pline=U._makeDiff(line),line=[])}},UTIF.decode._findDiff=function(line,x,clr){for(var i=0;i<line.length;i+=2)if(line[i]>=x&&line[i+1]==clr)return line[i]},UTIF.decode._makeDiff=function(line){var out=[];1==line[0]&&out.push(0,1);for(var i=1;i<line.length;i++)line[i-1]!=line[i]&&out.push(i,line[i]);return out.push(line.length,0,line.length,1),out},UTIF.decode._decodeG2=function(data,off,slen,tgt,toff,w,fo){for(var U=UTIF.decode,boff=off<<3,len=0,wrd="",line=[],clr=0,y=0,bipl=8*Math.ceil(w/8);boff>>>3<off+slen;){var bit=0;1==fo&&(bit=data[boff>>>3]>>>7-(7&boff)&1),2==fo&&(bit=data[boff>>>3]>>>(7&boff)&1),boff++,wrd+=bit,null!=(len=U._lens[clr][wrd])&&(U._addNtimes(line,len,clr),wrd="",len<64&&(clr=1-clr),line.length==w&&(U._writeBits(line,tgt,8*toff+y*bipl),line=[],y++,clr=0,0!=(7&boff)&&(boff+=8-(7&boff)),len>=64&&(boff+=8)))}},UTIF.decode._decodeG3=function(data,off,slen,tgt,toff,w,fo,twoDim){for(var U=UTIF.decode,boff=off<<3,len=0,wrd="",line=[],pline=[],i=0;i<w;i++)line.push(0);for(var a0=0,a1=0,a2=0,b1=0,b2=0,clr=0,y=-1,mode="",toRead=0,is1D=!0,bipl=8*Math.ceil(w/8);boff>>>3<off+slen;){b1=U._findDiff(pline,a0+(0==a0?0:1),1-clr),b2=U._findDiff(pline,b1,clr);var bit=0;if(1==fo&&(bit=data[boff>>>3]>>>7-(7&boff)&1),2==fo&&(bit=data[boff>>>3]>>>(7&boff)&1),boff++,wrd+=bit,is1D){if(null!=U._lens[clr][wrd]){var dl=U._lens[clr][wrd];wrd="",len+=dl,dl<64&&(U._addNtimes(line,len,clr),clr=1-clr,len=0)}}else if("H"==mode){if(null!=U._lens[clr][wrd]){var dl=U._lens[clr][wrd];wrd="",len+=dl,dl<64&&(U._addNtimes(line,len,clr),a0+=len,clr=1-clr,len=0,0==--toRead&&(mode=""))}}else"0001"==wrd&&(wrd="",U._addNtimes(line,b2-a0,clr),a0=b2),"001"==wrd&&(wrd="",mode="H",toRead=2),null!=U._dmap[wrd]&&(a1=b1+U._dmap[wrd],U._addNtimes(line,a1-a0,clr),a0=a1,wrd="",clr=1-clr);wrd.endsWith("000000000001")&&(y>=0&&U._writeBits(line,tgt,8*toff+y*bipl),twoDim&&(1==fo&&(is1D=1==(data[boff>>>3]>>>7-(7&boff)&1)),2==fo&&(is1D=1==(data[boff>>>3]>>>(7&boff)&1)),boff++),wrd="",clr=0,y++,a0=0,pline=U._makeDiff(line),line=[])}line.length==w&&U._writeBits(line,tgt,8*toff+y*bipl)},UTIF.decode._addNtimes=function(arr,n,val){for(var i=0;i<n;i++)arr.push(val)},UTIF.decode._writeBits=function(bits,tgt,boff){for(var i=0;i<bits.length;i++)tgt[boff+i>>>3]|=bits[i]<<7-(boff+i&7)},UTIF.decode._decodeLZW=UTIF.decode._decodeLZW=(K=0,V=0,g=0,N=0,O=function(){var S=e>>>3,A,j=(U[S]<<16|U[S+1]<<8|U[S+2])>>>24-(7&e)-V&(1<<V)-1;return e+=V,j},h=new Uint32Array(16384),w=0,m=function(S){if(S!=w){w=S,N=1+(g=1<<S);for(var A=0;A<N+1;A++)h[4*A]=h[4*A+3]=A,h[4*A+1]=65535,h[4*A+2]=1}},i=function(S){V=S+1,K=N+1},D=function(S){for(var A=S<<2,j=h[A+2],a=u+j-1;65535!=A;)Z[a--]=h[A],A=h[A+1];u+=j},L=function(S,A){var j=K<<2,a=S<<2;h[j]=h[3+(A<<2)],h[j+1]=a,h[j+2]=h[a+2]+1,h[j+3]=h[a+3],++K+1==1<<V&&12!=V&&V++},function(S,A,j,a,n,q){e=A<<3,U=S,Z=a,u=n;var B=A+j<<3,_=0,t=0;for(m(q),i(q);e<B&&(_=O())!=N;){if(_==g){if(i(q),(_=O())==N)break;D(_)}else _<K?(D(_),L(t,_)):(L(t,t),D(K-1));t=_}return u}),UTIF.tags={},UTIF._types=((main=new Array(250)).fill(0),{basic:{main:main=main.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}),UTIF._readIFD=function(bin,data,offset,ifds,depth,prm){var cnt=bin.readUshort(data,offset);offset+=2;var ifd={};prm.debug&&log("   ".repeat(depth),ifds.length-1,">>>----------------");for(var i=0;i<cnt;i++){var tag=bin.readUshort(data,offset);offset+=2;var type=bin.readUshort(data,offset);offset+=2;var num=bin.readUint(data,offset);offset+=4;var voff=bin.readUint(data,offset);offset+=4;var arr=[];if(1==type||7==type){var no=num<5?offset-4:voff;no+num>data.buffer.byteLength&&(num=data.buffer.byteLength-no),arr=new Uint8Array(data.buffer,no,num)}if(2==type){var o0=num<5?offset-4:voff,c=data[o0],len=Math.max(0,Math.min(num-1,data.length-o0));c<128||0==len?arr.push(bin.readASCII(data,o0,len)):arr=new Uint8Array(data.buffer,o0,len)}if(3==type)for(var j=0;j<num;j++)arr.push(bin.readUshort(data,(num<3?offset-4:voff)+2*j));if(4==type||13==type)for(var j=0;j<num;j++)arr.push(bin.readUint(data,(num<2?offset-4:voff)+4*j));if(5==type||10==type)for(var ri=5==type?bin.readUint:bin.readInt,j=0;j<num;j++)arr.push([ri(data,voff+8*j),ri(data,voff+8*j+4)]);if(8==type)for(var j=0;j<num;j++)arr.push(bin.readShort(data,(num<3?offset-4:voff)+2*j));if(9==type)for(var j=0;j<num;j++)arr.push(bin.readInt(data,(num<2?offset-4:voff)+4*j));if(11==type)for(var j=0;j<num;j++)arr.push(bin.readFloat(data,voff+4*j));if(12==type)for(var j=0;j<num;j++)arr.push(bin.readDouble(data,voff+8*j));if(0==num||0!=arr.length){if(prm.debug&&log("   ".repeat(depth),tag,type,UTIF.tags[tag],arr),ifd["t"+tag]=arr,330==tag&&ifd.t272&&"DSLR-A100"==ifd.t272[0]);else if(330==tag||34665==tag||34853==tag||50740==tag&&bin.readUshort(data,bin.readUint(arr,0))<300||61440==tag){for(var oarr=50740==tag?[bin.readUint(arr,0)]:arr,subfd=[],j=0;j<oarr.length;j++)UTIF._readIFD(bin,data,oarr[j],subfd,depth+1,prm);330==tag&&(ifd.subIFD=subfd),34665==tag&&(ifd.exifIFD=subfd[0]),34853==tag&&(ifd.gpsiIFD=subfd[0]),50740==tag&&(ifd.dngPrvt=subfd[0]),61440==tag&&(ifd.fujiIFD=subfd[0])}if(37500==tag&&prm.parseMN){var mn=arr;if("Nikon"==bin.readASCII(mn,0,5))ifd.makerNote=UTIF.decode(mn.slice(10).buffer)[0];else if(bin.readUshort(data,voff)<300&&bin.readUshort(data,voff+4)<=12){var subsub=[];UTIF._readIFD(bin,data,voff,subsub,depth+1,prm),ifd.makerNote=subsub[0]}}}else if(log(tag,"unknown TIFF tag type: ",type,"num:",num),0==i)return}return ifds.push(ifd),prm.debug&&log("   ".repeat(depth),"<<<---------------"),offset},UTIF._writeIFD=function(bin,types,data,offset,ifd){var keys=Object.keys(ifd),knum=keys.length;ifd.exifIFD&&knum--,ifd.gpsiIFD&&knum--,bin.writeUshort(data,offset,knum);for(var eoff=(offset+=2)+12*knum+4,ki=0;ki<keys.length;ki++){var key=keys[ki];if("t34665"!=key&&"t34853"!=key){"exifIFD"==key&&(key="t34665"),"gpsiIFD"==key&&(key="t34853");var tag=parseInt(key.slice(1)),type=types.main[tag];if(null==type&&(type=types.rest[tag]),null==type||0==type)throw new Error("unknown type of tag: "+tag);var val=ifd[key],outp,outp;if(34665==tag)val=[eoff],eoff=(outp=UTIF._writeIFD(bin,types,data,eoff,ifd.exifIFD))[1];if(34853==tag)val=[eoff],eoff=(outp=UTIF._writeIFD(bin,UTIF._types.gps,data,eoff,ifd.gpsiIFD))[1];2==type&&(val=val[0]+"\0");var num=val.length;bin.writeUshort(data,offset,tag),offset+=2,bin.writeUshort(data,offset,type),offset+=2,bin.writeUint(data,offset,num);var dlen=[-1,1,1,2,4,8,0,1,0,4,8,0,8][type]*num,toff=offset+=4;if(dlen>4&&(bin.writeUint(data,offset,eoff),toff=eoff),1==type||7==type)for(var i=0;i<num;i++)data[toff+i]=val[i];else if(2==type)bin.writeASCII(data,toff,val);else if(3==type)for(var i=0;i<num;i++)bin.writeUshort(data,toff+2*i,val[i]);else if(4==type)for(var i=0;i<num;i++)bin.writeUint(data,toff+4*i,val[i]);else if(5==type||10==type)for(var wr=5==type?bin.writeUint:bin.writeInt,i=0;i<num;i++){var v=val[i],nu=v[0],de=v[1];if(null==nu)throw"e";wr(data,toff+8*i,nu),wr(data,toff+8*i+4,de)}else if(9==type)for(var i=0;i<num;i++)bin.writeInt(data,toff+4*i,val[i]);else{if(12!=type)throw type;for(var i=0;i<num;i++)bin.writeDouble(data,toff+8*i,val[i])}dlen>4&&(eoff+=dlen+=1&dlen),offset+=4}}return[offset,eoff]},UTIF.toRGBA8=function(out,scl){function gamma(x){return x<.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055}var w=out.width,h=out.height,area=w*h,qarea=4*area,data=out.data,img=new Uint8Array(4*area),intp=out.t262?out.t262[0]:2,bps=out.t258?Math.min(32,out.t258[0]):1;null==out.t262&&1==bps&&(intp=0);var smpls=out.t277?out.t277[0]:out.t258?out.t258.length:[1,1,3,1,1,4,3][intp],bpl=Math.ceil(smpls*bps*w/8);if(0==intp){scl=1/256;for(var y=0;y<h;y++){var off=y*bpl,io=y*w;if(1==bps)for(var i=0;i<w;i++){var qi=io+i<<2,px=data[off+(i>>3)]>>7-(7&i)&1;img[qi]=img[qi+1]=img[qi+2]=255*(1-px),img[qi+3]=255}if(4==bps)for(var i=0;i<w;i++){var qi=io+i<<2,px=data[off+(i>>1)]>>4-4*(1&i)&15;img[qi]=img[qi+1]=img[qi+2]=17*(15-px),img[qi+3]=255}if(8==bps)for(var i=0;i<w;i++){var qi=io+i<<2,px=data[off+i];img[qi]=img[qi+1]=img[qi+2]=255-px,img[qi+3]=255}if(16==bps)for(var i=0;i<w;i++){var qi=io+i<<2,o,px=data[(o=off+2*i)+1]<<8|data[o];img[qi]=img[qi+1]=img[qi+2]=Math.min(255,255-~~(px*scl)),img[qi+3]=255}}}else if(1==intp){null==scl&&(scl=1/256);var f32=new Float32Array(data.buffer),sf=out.t339?out.t339[0]:null;if(32==bps&&3!=sf)throw"e";for(var y=0;y<h;y++){var off=y*bpl,io=y*w;if(1==bps)for(var i=0;i<w;i++){var qi=io+i<<2,px=data[off+(i>>3)]>>7-(7&i)&1;img[qi]=img[qi+1]=img[qi+2]=255*px,img[qi+3]=255}if(2==bps)for(var i=0;i<w;i++){var qi=io+i<<2,px=data[off+(i>>2)]>>6-2*(3&i)&3;img[qi]=img[qi+1]=img[qi+2]=85*px,img[qi+3]=255}if(8==bps)for(var i=0;i<w;i++){var qi=io+i<<2,px=data[off+i*smpls];img[qi]=img[qi+1]=img[qi+2]=px,img[qi+3]=255}if(16==bps)for(var i=0;i<w;i++){var qi=io+i<<2,o,px=data[(o=off+2*i)+1]<<8|data[o];img[qi]=img[qi+1]=img[qi+2]=Math.min(255,~~(px*scl)),img[qi+3]=255}if(32==bps)for(var i=0;i<w;i++){var qi=io+i<<2,o,px=f32[o=(off>>>2)+i];img[qi]=img[qi+1]=img[qi+2]=~~(.5+255*px),img[qi+3]=255}}}else if(2==intp)if(8==bps){if(1==smpls)for(var i=0;i<area;i++)img[4*i]=img[4*i+1]=img[4*i+2]=data[i],img[4*i+3]=255;if(3==smpls)for(var i=0;i<area;i++){var qi,ti=3*i;img[qi=i<<2]=data[ti],img[qi+1]=data[ti+1],img[qi+2]=data[ti+2],img[qi+3]=255}if(smpls>=4)for(var i=0;i<area;i++){var qi,ti=i*smpls;img[qi=i<<2]=data[ti],img[qi+1]=data[ti+1],img[qi+2]=data[ti+2],img[qi+3]=data[ti+3]}}else if(16==bps){if(4==smpls)for(var i=0;i<area;i++){var qi,ti=8*i+1;img[qi=i<<2]=data[ti],img[qi+1]=data[ti+2],img[qi+2]=data[ti+4],img[qi+3]=data[ti+6]}if(3==smpls)for(var i=0;i<area;i++){var qi,ti=6*i+1;img[qi=i<<2]=data[ti],img[qi+1]=data[ti+2],img[qi+2]=data[ti+4],img[qi+3]=255}}else{if(32!=bps)throw bps;for(var ndt=new Float32Array(data.buffer),min=0,i=0;i<ndt.length;i++)min=Math.min(min,ndt[i]);if(min<0)for(var i=0;i<data.length;i+=4){var t=data[i];data[i]=data[i+3],data[i+3]=t,t=data[i+1],data[i+1]=data[i+2],data[i+2]=t}for(var pmap=[],i=0;i<65536;i++)pmap.push(gamma(i/65535));for(var i=0;i<ndt.length;i++){var cv=Math.max(0,Math.min(1,ndt[i]));ndt[i]=pmap[~~(.5+65535*cv)]}if(3==smpls)for(var i=0;i<area;i++){var qi,ti=3*i;img[qi=i<<2]=~~(.5+255*ndt[ti]),img[qi+1]=~~(.5+255*ndt[ti+1]),img[qi+2]=~~(.5+255*ndt[ti+2]),img[qi+3]=255}else{if(4!=smpls)throw smpls;for(var i=0;i<area;i++){var qi,ti=4*i;img[qi=i<<2]=~~(.5+255*ndt[ti]),img[qi+1]=~~(.5+255*ndt[ti+1]),img[qi+2]=~~(.5+255*ndt[ti+2]),img[qi+3]=~~(.5+255*ndt[ti+3])}}}else if(3==intp)for(var map=out.t320,cn=1<<bps,nexta=8==bps&&smpls>1&&out.t338&&0!=out.t338[0],y=0;y<h;y++)for(var x=0;x<w;x++){var i,qi=(i=y*w+x)<<2,mi=0,dof=y*bpl;if(1==bps)mi=data[dof+(x>>>3)]>>>7-(7&x)&1;else if(2==bps)mi=data[dof+(x>>>2)]>>>6-2*(3&x)&3;else if(4==bps)mi=data[dof+(x>>>1)]>>>4-4*(1&x)&15;else{if(8!=bps)throw bps;mi=data[dof+x*smpls]}img[qi]=map[mi]>>8,img[qi+1]=map[cn+mi]>>8,img[qi+2]=map[cn+cn+mi]>>8,img[qi+3]=nexta?data[dof+x*smpls+1]:255}else if(5==intp)for(var gotAlpha=smpls>4?1:0,i=0;i<area;i++){var qi=i<<2,si=i*smpls;if(UDOC){var C=data[si],M=data[si+1],Y=data[si+2],K=data[si+3],c=UDOC.C.cmykToRgb([C*(1/255),M*(1/255),Y*(1/255),K*(1/255)]);img[qi]=~~(.5+255*c[0]),img[qi+1]=~~(.5+255*c[1]),img[qi+2]=~~(.5+255*c[2])}else{var C=255-data[si],M=255-data[si+1],Y=255-data[si+2],K=(255-data[si+3])*(1/255);img[qi]=~~(C*K+.5),img[qi+1]=~~(M*K+.5),img[qi+2]=~~(Y*K+.5)}img[qi+3]=255*(1-gotAlpha)+data[si+4]*gotAlpha}else if(6==intp&&out.t278)for(var rps=out.t278[0],y=0;y<h;y+=rps)for(var i=y*w,len=rps*w,j=0;j<len;j++){var qi=4*(i+j),si,Y=data[(si=3*i+4*(j>>>1))+(1&j)],Cb=data[si+2]-128,Cr=data[si+3]-128,r=Y+((Cr>>2)+(Cr>>3)+(Cr>>5)),g=Y-((Cb>>2)+(Cb>>4)+(Cb>>5))-((Cr>>1)+(Cr>>3)+(Cr>>4)+(Cr>>5)),b=Y+(Cb+(Cb>>1)+(Cb>>2)+(Cb>>6));img[qi]=Math.max(0,Math.min(255,r)),img[qi+1]=Math.max(0,Math.min(255,g)),img[qi+2]=Math.max(0,Math.min(255,b)),img[qi+3]=255}else if(32845==intp)for(var y=0;y<h;y++)for(var x=0;x<w;x++){var si,qi=4*(y*w+x),L=data[(si=6*(y*w+x))+1]<<8|data[si],L=Math.pow(2,(L+.5)/256-64),u=(data[si+3]+.5)/410,v=(data[si+5]+.5)/410,sX=9*u/(6*u-16*v+12),sY=4*v/(6*u-16*v+12),bY=L,X=sX*L/sY,Y,Z=(1-sX-sY)*L/sY,r=2.69*X-1.276*(Y=L)-.414*Z,g=-1.022*X+1.978*Y+.044*Z,b=.061*X-.224*Y+1.163*Z;img[qi]=255*gamma(Math.min(r,1)),img[qi+1]=255*gamma(Math.min(g,1)),img[qi+2]=255*gamma(Math.min(b,1)),img[qi+3]=255}else log("Unknown Photometric interpretation: "+intp);return img},UTIF.replaceIMG=function(imgs){null==imgs&&(imgs=document.getElementsByTagName("img"));for(var sufs=["tif","tiff","dng","cr2","nef"],i=0;i<imgs.length;i++){var img=imgs[i],src=img.getAttribute("src");if(null!=src){var suff=src.split(".").pop().toLowerCase();if(-1!=sufs.indexOf(suff)){var xhr=new XMLHttpRequest;UTIF._xhrs.push(xhr),UTIF._imgs.push(img),xhr.open("GET",src),xhr.responseType="arraybuffer",xhr.onload=UTIF._imgLoaded,xhr.send()}}}},UTIF._xhrs=[],UTIF._imgs=[],UTIF._imgLoaded=function(e){var ind=UTIF._xhrs.indexOf(e.target),img=UTIF._imgs[ind];UTIF._xhrs.splice(ind,1),UTIF._imgs.splice(ind,1),img.setAttribute("src",UTIF.bufferToURI(e.target.response))},UTIF.bufferToURI=function(buff){var ifds=UTIF.decode(buff),vsns=ifds,ma=0,page=vsns[0];ifds[0].subIFD&&(vsns=vsns.concat(ifds[0].subIFD));for(var i=0;i<vsns.length;i++){var img=vsns[i];if(!(null==img.t258||img.t258.length<3)){var ar=img.t256*img.t257;ar>ma&&(ma=ar,page=img)}}UTIF.decodeImage(buff,page,ifds);var rgba=UTIF.toRGBA8(page),w=page.width,h=page.height,cnv=document.createElement("canvas");cnv.width=w,cnv.height=h;var ctx=cnv.getContext("2d"),imgd=new ImageData(new Uint8ClampedArray(rgba.buffer),w,h);return ctx.putImageData(imgd,0,0),cnv.toDataURL()},UTIF._binBE={nextZero:function(data,o){for(;0!=data[o];)o++;return o},readUshort:function(buff,p){return buff[p]<<8|buff[p+1]},readShort:function(buff,p){var a=UTIF._binBE.ui8;return a[0]=buff[p+1],a[1]=buff[p+0],UTIF._binBE.i16[0]},readInt:function(buff,p){var a=UTIF._binBE.ui8;return a[0]=buff[p+3],a[1]=buff[p+2],a[2]=buff[p+1],a[3]=buff[p+0],UTIF._binBE.i32[0]},readUint:function(buff,p){var a=UTIF._binBE.ui8;return a[0]=buff[p+3],a[1]=buff[p+2],a[2]=buff[p+1],a[3]=buff[p+0],UTIF._binBE.ui32[0]},readASCII:function(buff,p,l){for(var s="",i=0;i<l;i++)s+=String.fromCharCode(buff[p+i]);return s},readFloat:function(buff,p){for(var a=UTIF._binBE.ui8,i=0;i<4;i++)a[i]=buff[p+3-i];return UTIF._binBE.fl32[0]},readDouble:function(buff,p){for(var a=UTIF._binBE.ui8,i=0;i<8;i++)a[i]=buff[p+7-i];return UTIF._binBE.fl64[0]},writeUshort:function(buff,p,n){buff[p]=n>>8&255,buff[p+1]=255&n},writeInt:function(buff,p,n){var a=UTIF._binBE.ui8;UTIF._binBE.i32[0]=n,buff[p+3]=a[0],buff[p+2]=a[1],buff[p+1]=a[2],buff[p+0]=a[3]},writeUint:function(buff,p,n){buff[p]=n>>24&255,buff[p+1]=n>>16&255,buff[p+2]=n>>8&255,buff[p+3]=n>>0&255},writeASCII:function(buff,p,s){for(var i=0;i<s.length;i++)buff[p+i]=s.charCodeAt(i)},writeDouble:function(buff,p,n){UTIF._binBE.fl64[0]=n;for(var i=0;i<8;i++)buff[p+i]=UTIF._binBE.ui8[7-i]}},UTIF._binBE.ui8=new Uint8Array(8),UTIF._binBE.i16=new Int16Array(UTIF._binBE.ui8.buffer),UTIF._binBE.i32=new Int32Array(UTIF._binBE.ui8.buffer),UTIF._binBE.ui32=new Uint32Array(UTIF._binBE.ui8.buffer),UTIF._binBE.fl32=new Float32Array(UTIF._binBE.ui8.buffer),UTIF._binBE.fl64=new Float64Array(UTIF._binBE.ui8.buffer),UTIF._binLE={nextZero:UTIF._binBE.nextZero,readUshort:function(buff,p){return buff[p+1]<<8|buff[p]},readShort:function(buff,p){var a=UTIF._binBE.ui8;return a[0]=buff[p+0],a[1]=buff[p+1],UTIF._binBE.i16[0]},readInt:function(buff,p){var a=UTIF._binBE.ui8;return a[0]=buff[p+0],a[1]=buff[p+1],a[2]=buff[p+2],a[3]=buff[p+3],UTIF._binBE.i32[0]},readUint:function(buff,p){var a=UTIF._binBE.ui8;return a[0]=buff[p+0],a[1]=buff[p+1],a[2]=buff[p+2],a[3]=buff[p+3],UTIF._binBE.ui32[0]},readASCII:UTIF._binBE.readASCII,readFloat:function(buff,p){for(var a=UTIF._binBE.ui8,i=0;i<4;i++)a[i]=buff[p+i];return UTIF._binBE.fl32[0]},readDouble:function(buff,p){for(var a=UTIF._binBE.ui8,i=0;i<8;i++)a[i]=buff[p+i];return UTIF._binBE.fl64[0]},writeUshort:function(buff,p,n){buff[p]=255&n,buff[p+1]=n>>8&255},writeInt:function(buff,p,n){var a=UTIF._binBE.ui8;UTIF._binBE.i32[0]=n,buff[p+0]=a[0],buff[p+1]=a[1],buff[p+2]=a[2],buff[p+3]=a[3]},writeUint:function(buff,p,n){buff[p]=n>>>0&255,buff[p+1]=n>>>8&255,buff[p+2]=n>>>16&255,buff[p+3]=n>>>24&255},writeASCII:UTIF._binBE.writeASCII},UTIF._copyTile=function(tb,tw,th,b,w,h,xoff,yoff){for(var xlim=Math.min(tw,w-xoff),ylim=Math.min(th,h-yoff),y=0;y<ylim;y++)for(var tof=(yoff+y)*w+xoff,sof=y*tw,x=0;x<xlim;x++)b[tof+x]=tb[sof+x]},UTIF.LosslessJpegDecode=function(){var o,_;function u(){return o[_++]}function G(){return o[_++]<<8|o[_++]}function Z(l){for(var A=u(),g=[0,0,0,255],K=[],L=8,t=0;t<16;t++)K[t]=u();for(var t=0;t<16;t++)for(var F=0;F<K[t];F++){var $;g[P(g,0,t+1,1)+3]=u()}var w=new Uint8Array(256);l[A]=[new Uint8Array(g),w];for(var t=0;t<256;t++){for(var r=8,M=t,X=0,y=0;255==g[X+3]&&0!=r;)X=g[X+(y=M>>--r&1)];w[t]=X}}function P(l,A,g,K){if(255!=l[A+3])return 0;if(0==g)return A;for(var t=0;t<2;t++){0==l[A+t]&&(l[A+t]=l.length,l.push(0,0,K,255));var F=P(l,l[A+t],g-1,K+1);if(0!=F)return F}return 0}function f(l){for(var A=l.b,g=l.a;A<25&&l.e<l.d;){var K=l.data[l.e++];l.c||(l.e+=K+1>>>8),g=g<<8|K,A+=8}if(A<0)throw"e";l.b=A,l.a=g}function O(l,A){return A.b<l&&f(A),A.a>>(A.b-=l)&65535>>16-l}function B(l,A){var g=l[0],K=0,t=255,F=0;A.b<16&&f(A);var $=A.a>>A.b-8&255;for(t=g[(K=l[1][$])+3],A.b-=g[K+2];255==t;)t=g[(K=g[K+(F=A.a>>--A.b&1)])+3];return t}function D(l,A){return l<32768>>16-A&&(l+=1-(1<<A)),l}function h(l,A){var g=B(l,A),K;return 0==g?0:16==g?-32768:D(O(g,A),g)}function a(l,A,g,K,t,F){for(var $=0;$<F;$++)for(var _=$*A,L=0;L<A;L+=t)for(var r=0;r<t;r++)l[_+L+r]=h(K[r],g)}function j(l,A){return D(O(l,A),l)}function b(l,A,g,K,t){for(var F=o.length-_,$=0;$<F;$+=4){var L=o[_+$];o[_+$]=o[_+$+3],o[_+$+3]=L;var L=o[_+$+1];o[_+$+1]=o[_+$+2],o[_+$+2]=L}for(var w=0;w<t;w++)for(var r=32768,M=32768,X=0;X<A;X+=2){var y=B(K,g),z=B(K,g);0!=y&&(r+=j(y,g)),0!=z&&(M+=j(z,g)),l[w*A+X]=65535&r,l[w*A+X+1]=65535&M}}function x(l){if(o=l,_=0,65496!=G())throw"e";for(var A=[],g=0,K=0,t=[],F=[],$=[],L=0,w=0,r=0;;){var M=G();if(65535!=M){var X=G();if(65475==M){K=u(),w=G(),r=G(),L=u();for(var y=0;y<L;y++){var z=u(),q=u(),n;if(0!=u())throw"e";A[z]=[y,q>>4,15&q]}}else if(65476==M)for(var m=_+X-2;_<m;)Z(F);else{if(65498==M){_++;for(var y=0;y<L;y++){var p,i=A[u()];$[i[0]]=F[u()>>>4],t[i[0]]=i.slice(1)}g=u(),_+=2;break}_+=X-2}}else _--}var T,Y=new(K>8?Uint16Array:Uint8Array)(w*r*L),d={b:0,a:0,c:8==g,e:_,data:o,d:o.length};if(d.c)b(Y,r*L,d,$[0],w);else{for(var v=[],Q=0,C=0,y=0;y<L;y++){var U=t[y],s,H;(s=U[0])>Q&&(Q=s),(H=U[1])>C&&(C=H),v.push(s*H)}if(1!=Q||1!=C){for(var E=[],c=0,y=0;y<L;y++){for(var R=0;R<v[y];R++)E.push($[y]);c+=v[y]}var k=r/Q,e=w/C;a(Y,k*c,d,E,c,e),J(Y,g,k,e,c-2,c,c,K);for(var V=Y.slice(0),H=0;H<w;H++)for(var s=0;s<r;s++)for(var a5=(H*r+s)*L,a3,a1,a6=~~(H/C)*k+~~(s/Q),I=0,y=0;y<L;y++){var N=1&s,a2,a0=2==C?1&H:0,a4=a6*c+I+(0==y?1==C?N:2*N+(1&H):0);Y[a5+y]=V[a4],I+=v[y]}J(Y,g,r,w,0,1,L,K)}else a(Y,r*L,d,$,L,w),J(Y,g,r,w,0,L,L,K)}return Y}function J(l,A,g,K,t,F,L,w){for(var r=g*L,M=t;M<F;M++)l[M]+=1<<w-1;for(var X=L;X<r;X+=L)for(var M=t;M<F;M++)l[X+M]+=l[X+M-L];for(var y=1;y<K;y++){for(var z=y*r,M=t;M<F;M++)l[z+M]+=l[z+M-r];for(var X=L;X<r;X+=L)for(var M=t;M<F;M++){var q=z+X+M,n=q-r,m=l[q-L],S=0;if(0==A)S=0;else if(1==A)S=m;else if(2==A)S=l[n];else if(3==A)S=l[n-L];else if(4==A)S=m+(l[n]-l[n-L]);else if(5==A)S=m+(l[n]-l[n-L]>>>1);else if(6==A)S=l[n]+(m-l[n-L]>>>1);else{if(7!=A)throw A;S=m+l[n]>>>1}l[q]+=S}}}return x}(),function(){var G=0,F=1,i=2,b=3,J=4,N=5,E=6,s=7,c=8,T=9,a3=10,f=11,q=12,M=13,m=14,x=15,L=16,$=17,p=18;function a5(t){var Z=UTIF._binBE.readUshort,u={b:Z(t,0),i:t[2],C:t[3],u:t[4],q:Z(t,5),k:Z(t,7),e:Z(t,9),l:Z(t,11),s:t[13],d:Z(t,14)};if(18771!=u.b||u.i>1||u.q<6||u.q%6||u.e<768||u.e%24||768!=u.l||u.k<u.l||u.k%u.l||u.k-u.e>=u.l||u.s>16||u.s!=u.k/u.l||u.s!=Math.ceil(u.e/u.l)||u.d!=u.q/6||12!=u.u&&14!=u.u&&16!=u.u||16!=u.C&&0!=u.C)throw"Invalid data";if(0==u.i)throw"Not implemented. We need this file!";return u.h=16==u.C,u.m=0|(u.h?2*u.l/3:u.l>>>1),u.A=u.m+2,u.f=64,u.g=(1<<u.u)-1,u.n=4*u.u,u}function a7(t,Z){var u=new Array(Z.s),e=4*Z.s,Q=16+e;12&e&&(Q+=16-(12&e));for(var V=0,O=16;V<Z.s;O+=4){var o=UTIF._binBE.readUint(t,O);u[V]=t.slice(Q,Q+o),u[V].j=0,u[V].a=0,Q+=o,V++}if(Q!=t.length)throw"Invalid data";return u}function a6(t,Z){for(var u=-Z[4],e=0;u<=Z[4];e++,u++)t[e]=u<=-Z[3]?-4:u<=-Z[2]?-3:u<=-Z[1]?-2:u<-Z[0]?-1:u<=Z[0]?0:u<Z[1]?1:u<Z[2]?2:u<Z[3]?3:4}function a1(t,Z,u){var e=[Z,3*Z+18,5*Z+67,7*Z+276,u];t.o=Z,t.w=(e[4]+2*Z)/(2*Z+1)+1|0,t.v=Math.ceil(Math.log2(t.w)),t.t=9,a6(t.c,e)}function a2(t){var Z={c:new Int8Array(2<<t.u)};return a1(Z,0,t.g),Z}function D(t){for(var Z=[[],[],[]],u=Math.max(2,t.w+32>>>6),e=0;e<3;e++)for(var Q=0;Q<41;Q++)Z[e][Q]=[u,1];return Z}function a4(t){for(var Z=-1,u=0;!u;Z++)u=t[t.j]>>>7-t.a&1,t.a++,t.a&=7,t.a||t.j++;return Z}function K(t,Z){var u=0,e=8-t.a,Q=t.j,V=t.a;if(Z){if(Z>=e)do{u<<=e,Z-=e,u|=t[t.j]&(1<<e)-1,t.j++,e=8}while(Z>=8);Z&&(u<<=Z,e-=Z,u|=t[t.j]>>>e&(1<<Z)-1),t.a=8-e}return u}function a0(t,Z){var u=0;if(Z<t)for(;u<=14&&Z<<++u<t;);return u}function r(t,Z,u,e,Q,V,O,o){null==o&&(o=0);var X=V+1,k=X%2,j=0,I=0,a=0,l,R,w=e[Q],S=e[Q-1],H=e[Q-2][X],g=S[X-1],Y=S[X],P=S[X+1],A=w[X-1],v=w[X+1],y=Math.abs,d,C,n,h;if(k&&(d=y(P-Y),C=y(H-Y),n=y(g-Y)),k){if(h=(h=d>n&&C<d?H+g:d<n&&C<n?H+P:P+g)+2*Y>>>2,o)return void(w[X]=h);l=Z.t*Z.c[t.g+Y-H]+Z.c[t.g+g-Y]}else h=Y>g&&Y>P||Y<g&&Y<P?v+A+2*Y>>>2:A+v>>>1,l=Z.t*Z.c[t.g+Y-g]+Z.c[t.g+g-A];R=y(l);var W=a4(u);if(W<t.n-Z.v-1){var z=a0(O[R][0],O[R][1]);a=K(u,z)+(W<<z)}else a=K(u,Z.v)+1;a=1&a?-1-(a>>>1):a>>>1,O[R][0]+=y(a),O[R][1]==t.f&&(O[R][0]>>>=1,O[R][1]>>>=1),O[R][1]++,h=l<0?h-a:h+a,t.i&&(h<0?h+=Z.w:h>t.g&&(h-=Z.w)),w[X]=h>=0?Math.min(h,t.g):0}function U(t,Z,u){for(var e=t[0].length,Q=Z;Q<=u;Q++)t[Q][0]=t[Q-1][1],t[Q][e-1]=t[Q-1][e-2]}function B(t){U(t,7,q),U(t,2,4),U(t,x,$)}function _(t,Z,u,e,Q,V,O,o,X,k,j,I,a){for(var l=0,R=1,w=Q<M&&Q>4;R<t.m;)l<t.m&&(r(t,Z,u,e,Q,l,O[X],t.h&&(w&&k||!w&&(j||(l&I)==a))),r(t,Z,u,e,V,l,O[X],t.h&&(!w&&k||w&&(j||(l&I)==a))),l+=2),l>8&&(r(t,Z,u,e,Q,R,o[X]),r(t,Z,u,e,V,R,o[X]),R+=2);B(e)}function a8(t,Z,u,e,Q,V){_(t,Z,u,e,2,7,Q,V,0,0,1,0,8),_(t,Z,u,e,8,x,Q,V,1,0,1,0,8),_(t,Z,u,e,3,9,Q,V,2,1,0,3,0),_(t,Z,u,e,10,L,Q,V,0,0,0,3,2),_(t,Z,u,e,4,f,Q,V,1,0,0,3,2),_(t,Z,u,e,q,$,Q,V,2,1,0,3,0)}function a9(t,Z,u,e,Q,V){var O=V.length,o=t.l;Q+1==t.s&&(o=t.e-Q*t.l);for(var X=6*t.e*e+Q*t.l,k=0;k<6;k++){for(var j=0;j<o;j++){var I=V[k%O][j%O],a;a=0==I?2+(k>>>1):2==I?x+(k>>>1):7+k;var l=t.h?(2*j/3&2147483646|j%3&1)+(j%3>>>1):j>>>1;Z[X+j]=u[a][l+1]}X+=t.e}}UTIF._decompressRAF=function(t,Z){var u=a5(t),e=a7(t,u),Q=a2(u),V=new Int16Array(u.e*u.q);null==Z&&(Z=u.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var O=[[0,3],[1,4],[N,f],[E,q],[M,L],[m,$]],o=[],X=0;X<p;X++)o[X]=new Uint16Array(u.A);for(var k=0;k<u.s;k++){for(var j=D(Q),I=D(Q),X=0;X<p;X++)for(var a=0;a<u.A;a++)o[X][a]=0;for(var l=0;l<u.d;l++){a8(u,Q,e[k],o,j,I);for(var X=0;X<6;X++)for(var a=0;a<u.A;a++)o[O[X][0]][a]=o[O[X][1]][a];a9(u,V,o,l,k,Z);for(var X=2;X<p;X++)if(-1==[N,E,M,m].indexOf(X))for(var a=0;a<u.A;a++)o[X][a]=0;B(o)}}return V}}()}(UTIF,"function"==typeof require?require("pako"):self.pako)}();